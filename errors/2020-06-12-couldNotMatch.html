<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ko" lang="ko">

<head>
  <script>
    (function () {
      const savedTheme = localStorage.getItem('theme');
      if (savedTheme === 'dark') {
        document.documentElement.classList.add('dark-mode');
      }
    })();

    function loadUtterances() {
      const savedTheme = localStorage.getItem('theme');
      const themeValue = savedTheme === 'dark' ? 'github-dark' : 'github-light';

      console.log("theme");
      console.log(themeValue);
      const script = document.createElement('script');
      script.src = 'https://utteranc.es/client.js';
      script.setAttribute('repo', 'lionhairdino/lionhairdino.github.io');
      script.setAttribute('issue-term', 'url');
      script.setAttribute('theme', themeValue);
      script.setAttribute('crossorigin', 'anonymous');
      script.async = true;
      document.body.appendChild(script);
    };

    function updateUtterancesTheme() {
      const savedTheme = localStorage.getItem('theme');
      const themeValue = savedTheme === 'dark' ? 'github-dark' : 'github-light';

      // Utterances iframe에 메시지 전송
      const utterances = document.querySelector('.utterances iframe');
      if (utterances) {
        utterances.contentWindow.postMessage(
          {type: 'set-theme', theme: themeValue},
          'https://utteranc.es'
        );
      }
    }

  </script>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>lionhairdino - 컴파일 에러 읽기 - Couldn't match type, Could not deduce,  No instance</title>
  
  <meta name="description" content="lionhairdino - 컴파일 에러 읽기 - Couldn't match type, Could not deduce,  No instance" />
  <meta property="og:description" content="하스켈 함수형 프로그래밍" />
  
  <link rel="stylesheet" type="text/css" href="../css/default.css" />
  <link rel="icon" href="https://lionhairdino.github.io/favicon.svg" />
  <link rel="icon" type="image/png" href="../images/favicon/Lionhairdino16px.png" sizes="16x16" />
  <link rel="icon" type="image/png" href="../images/favicon/Lionhairdino24px.png" sizes="24x24" />
  <link rel="icon" type="image/png" href="../images/favicon/Lionhairdino32px.png" sizes="32x32" />
  <link rel="icon" type="image/png" href="../images/favicon/Lionhairdino48px.png" sizes="48x48" />
  <link rel="icon" type="image/png" href="../images/favicon/Lionhairdino57px.png" sizes="57x57" />
  <link rel="icon" type="image/png" href="../images/favicon/Lionhairdino60px.png" sizes="60x60" />
  <link rel="icon" type="image/png" href="../images/favicon/Lionhairdino64px.png" sizes="64x64" />
  <link rel="icon" type="image/png" href="../images/favicon/Lionhairdino72px.png" sizes="72x72" />
  <link rel="icon" type="image/png" href="../images/favicon/Lionhairdino76px.png" sizes="76x76" />
  <link rel="icon" type="image/png" href="../images/favicon/Lionhairdino114px.png" sizes="114x114" />
  <link rel="apple-touch-icon-precomposed" href="../images/favicon/Lionhairdino120px.png" sizes="120x120" />
  <link rel="apple-touch-icon-precomposed" href="../images/favicon/Lionhairdino144px.png" sizes="144x144" />
  <link rel="shortcut icon" href="../favicon.ico" />
  <link rel="apple-touch-icon-precomposed" href="../images/favicon/Lionhairdino152px.png" sizes="152x152" />
  <link rel="apple-touch-icon-precomposed" href="../images/favicon/Lionhairdino180px.png" sizes="180x180" />
  <link rel="icon" type="image/png" href="../images/favicon/Lionhairdino192px.png" sizes="192x192" />
  <link rel="manifest" href="../site.webmanifest" />
  <link rel="mask-icon" href="https://lionhairdino.github.io/Lionhairdino_black.svg" color="#ff7500" />
  <meta name="msapplication-TileImage" content="/images/favicon/Lionhairdino144px.png" />
  <meta name="msapplication-TileColor" content="#ff7500" />
  <meta name="theme-color" content="#ffffff" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="컴파일 에러 읽기 - Couldn't match type, Could not deduce,  No instance" />
  <meta property="og:site_name" content="Lionhairdino" />
  <meta property="og:url" content="https://lionhairdino.github.io/errors/2020-06-12-couldNotMatch.html" />
  
  <meta property="og:image" content="https://lionhairdino.github.io/images/state400px.png" />
  
  
  <meta name="keywords" content="에러, error, deduce, 타입 추론, match, 타입 매칭, match type, deduce, No instance, constraint, 제약, forall">
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-E9WZ6VXGHP"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() {dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-E9WZ6VXGHP');
  </script>
  <script src="../script/copycode.js"></script>

  <script src="../script/darkmode.js"></script>
  <script async src="https://cse.google.com/cse.js?cx=9c53b4915cbb2605c"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.11.1/tocbot.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.11.1/tocbot.css" />
  <meta name="fediverse:creator" content="@lionhairdino@mastodon.social" />
  <link rel="alternate" type="application/rss+xml" title="상상 하스켈 - Lionhairdino" href="rss.xml" />
</head>

<body>
  <div id="header">
    <div style="display:inline-block;margin-right:5px;padding-top: 5px;" id="logo">
      <a href="../"><img style="width:30px;border:none" src="../images/favicon/Lionhairdino48px.png"></a>
    </div>
    <div style="display:inline-block;vertical-align: top;padding-top:5px;" id="navigation">
      <a href="../">lionhairdino</a>
      <a href="../about.html">about</a>
      <!--<a href="/archive.html">archive</a>-->
    </div>
    <div style="display:inline-block;font-size:0.8em;vertical-align: top;">
      <div style="display:inline-block;vertical-align: top;padding-top: 5px"></div>
      <div style="display:inline-block;vertical-align: top;padding-top: 11px; padding-left: 10px;"><a rel="me" href="https://mastodon.social/@lionhairdino"><img style="width:20px;border:none" src="../images/mastodon.svg"></a></div>
      <div style="display:inline-block;vertical-align: top;padding-top: 11px; padding-left: 2px;"><a rel="me" href="https://lionhairdino.bsky.social"><img style="width:18px;border:none" src="../images/bluesky.svg"></a>
      </div>
      <div style="display:inline-block;vertical-align: top;padding-top: 11px; padding-left: 2px;"><a rel="me" href="https://discordapp.com/users/lionhairdino#7687"><img style="width:20px;border:none" src="../images/discord.svg"></a></div>
      <div style="display:inline-block;vertical-align: top;padding-top: 11px; padding-left: 2px;"><a rel="me" href="https://x.com/lionhairdino"><img style="width:15px;border:none" src="../images/X.svg"></a></div>
      <div style="display:inline-block;vertical-align: top;padding-top: 11px; padding-left: 2px;"><a rel="me" href="https://linkedin.com/in/lionhairdino-l-baaa54244"><img style="width:20px;border:none" src="../images/linkedin.svg"></a></div>
      <div style="display:inline-block;vertical-align: top;padding-top: 11px; padding-left: 2px;"><a rel="me" href="https://github.com/lionhairdino"><img style="width:20px;border:none" src="../images/github.svg"></a></div>
      <div style="display:inline-block;vertical-align: top;padding-top: 11px; padding-left: 2px;"><a rel="me" href="https://www.threads.net/@linohairdino"><img style="width:20px;border:none" src="../images/threads.svg"></a></div>
      <div style="display:inline-block;vertical-align: top;padding-top: 10px; padding-left: 0px;"><a rel="me" href="https://hackers.pub/@lionhairdino"><img style="width:22px;border:none" src="../images/hackerspub_angry.svg"></a></div>
    </div>
    <div>
      <div style="display:inline-block;width:180px;">
        <div class="gcse-searchbox-only"></div>
        <div><button id="theme-toggle">
            <script>
              const savedTheme = localStorage.getItem('theme');
              if (savedTheme === 'dark')
                document.write("☉");
              else
                document.write("☾");
            </script>
          </button></div>
      </div>
    </div>
    <div>
      여기 글들은 일종의 질문입니다. 용어 선택도 학계, 업계에서 쓰는 걸로 되어 있지 않고, 틀린 내용이 있을 수도 있습니다. 여기 글을 처음 읽는 분은, 먼저 <a href="../warning.html">주의문</a>을 꼭 읽어보세요.
    </div>
  </div>
  <div class="js-toc-content">
    <h1>컴파일 에러 읽기 - Couldn't match type, Could not deduce,  No instance</h1>
    <link rel="stylesheet" type="text/css" href="../css/syntax.css" />
<div class="info">
    Posted on June 12, 2020
    
</div>

<p>에러 메시지를 문장 그대로 읽으려면 다음에 익숙해져야 합니다.</p>
<p><em>rising</em> : 타입을 결정해 가는 과정은, 타입 제약을 쌓아가다 한 가지 타입으로 추론 될 수도 있고, 그냥 타입 제약까지만 결정될 수도 있습니다. 전체 진행 과정을 타입 추론이라고 하지만, 하나의 단서로 인해 나온 조건은 추론deduced됐다 표현하지 않고, rising 됐다 표현합니다. (제 생각은 추론deduced된 경우만 있는게 아니라, 지정specified 했을 경우도 있으니 rising이라 표현하지 않았을까 합니다.)</p>
<p><em>rigid</em> : rigid는 융통성이 없다는 뜻인데, 여기선 어떤 형태로 지정됐기 때문에 더 이상 다른 형태로 추론하지 못한다는 뜻에서 <em>지정</em>으로 번역했습니다.</p>
<p><em>forall</em> : 아무 타입이나 와도 된다가 아니라, 반드시 아무 타입이 들어와도 문제가 없어야 한다 입니다. 단어 그대로 어느 한 가지 타입이 아닌 <em>모든 타입</em>입니다. 특정 확장들을 켜지 않으면 서명에 드러나진 않지만, 서명에 아무런 제약없이 써있는 소문자들은 forall a 타입으로 보면 됩니다.</p>
<p><em>(forall ) constraint</em> : constraint를 써주는 것도 사실은 forall이 숨어 있습니다. constraint를 따르는 모든forall 타입을 받아 들여도 문제가 없다는 뜻입니다.</p>
<p>딱 부러지게 나온 구체 타입, 어떤 종류의 타입, 모든 타입… 이들 모두를 타입이라 표현하겠습니다. 무슨말이냐 하면 IO 타입, MonadIO =&gt; 타입, forall 타입 이들이 모두 그냥 같은 수준의 다른 타입들입니다. IO타입과 MonadIO =&gt; 는 서로 다른 타입입니다. MonadIO =&gt; 타입과 forall 타입은 서로 다른 타입입니다. 예를 들어, forall 타입을 받는 함수와, MonadIO =&gt; 타입을 받는 함수는 다른 타입의 함수입니다.</p>
<p>물론, 바이너리가 만들어질 때 IO타입처럼 구체 타입이 아닌 타입들은 언젠가 절차를 거쳐 구체 타입이 될 겁니다. 하지만, 에러를 읽을 때는 특별한 다음 절차를 내포했다는 건 잠시 잊어버리고 그냥 타입으로 바라봅니다. 에러에 등장하는 타입은</p>
<p>Int, Maybe Int, Strin, [], MonadIO =&gt; 타입, forall 타입….</p>
<p>모두 같은 선상에 놓인 타입이란 뜻입니다.</p>
<h2 id="no-instance---인스턴스가-있는-타입으로-바꿔-봐">No instance - 인스턴스가 있는 타입으로 바꿔 봐</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="dt">Control.Monad.Reader</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="ot">func1 ::</span> m ()</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>func1 <span class="ot">=</span> <span class="kw">do</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  a <span class="ot">&lt;-</span> ask</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  liftIO <span class="op">$</span> <span class="fu">print</span> a</span></code></pre></div>
<p>컴파일 하면</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>    • <span class="dt">No</span> <span class="kw">instance</span> for (<span class="dt">Monad</span> m) arising from a <span class="kw">do</span> statement</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>      <span class="dt">Possible</span> fix<span class="op">:</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>        add (<span class="dt">Monad</span> m) to the context <span class="kw">of</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>          the <span class="kw">type</span> signature for<span class="op">:</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="ot">            func1 ::</span> <span class="kw">forall</span> (<span class="ot">m ::</span> <span class="op">*</span> <span class="ot">-&gt;</span> <span class="op">*</span>)<span class="op">.</span> m ()</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="op">|</span>   a <span class="ot">&lt;-</span> ask</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    • <span class="dt">Ambiguous</span> <span class="kw">type</span> variable ‘a0’ arising from a use <span class="kw">of</span> ‘ask’</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>      prevents the constraint ‘(<span class="dt">MonadReader</span> a0 m)’ from being solved<span class="op">.</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>      <span class="dt">Relevant</span> bindings include<span class="ot"> func1 ::</span> m () (bound at test<span class="op">.</span>hs<span class="op">:</span><span class="dv">7</span><span class="op">:</span><span class="dv">1</span>)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="op">|</span>   a <span class="ot">&lt;-</span> ask</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    • <span class="dt">No</span> <span class="kw">instance</span> for (<span class="dt">MonadIO</span> m) arising from a use <span class="kw">of</span> ‘liftIO’</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>      <span class="dt">Possible</span> fix<span class="op">:</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>        add (<span class="dt">MonadIO</span> m) to the context <span class="kw">of</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>          the <span class="kw">type</span> signature for<span class="op">:</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="ot">            func1 ::</span> <span class="kw">forall</span> (<span class="ot">m ::</span> <span class="op">*</span> <span class="ot">-&gt;</span> <span class="op">*</span>)<span class="op">.</span> m ()</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="op">|</span>   liftIO <span class="op">$</span> <span class="fu">print</span> a</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>    • <span class="dt">Ambiguous</span> <span class="kw">type</span> variable ‘a0’ arising from a use <span class="kw">of</span> ‘print’</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>      prevents the constraint ‘(<span class="dt">Show</span> a0)’ from being solved<span class="op">.</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>      <span class="dt">Relevant</span> bindings include<span class="ot"> a ::</span> a0 (bound at test<span class="op">.</span>hs<span class="op">:</span><span class="dv">12</span><span class="op">:</span><span class="dv">3</span>)</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a><span class="op">|</span>   liftIO <span class="op">$</span> <span class="fu">print</span> a</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a><span class="op">...</span></span></code></pre></div>
<p>첫 번째 에레는,<br />
“<code>do</code>구문을 보고 나온 형태 <code>(Monad m)</code> 인스턴스가 없다.”<br />
<code>m</code>은 특별히 결정한 형태가 없습니다. <code>* -&gt; *</code> 카인드의 <em>모든 타입</em>입니다. 모든 <code>m</code>을 위한 <code>Monad</code> 인스턴스는 당연히 없습니다.</p>
<p>두 번째 에러는,<br />
“<code>ask</code>를 보고 나온 타입 변수 <code>a0</code>가 모호해서, 제약constraint <code>(MonadReader a0 m)</code>을 풀 수 없다.”<br />
<code>ask</code>는 <code>MonadReader</code>클래스의 메소드이니, <code>(MonadReader a0 m =&gt; )</code> 타입 형태인데, <code>a0</code>가 뭔지 알 수 없다입니다. 이 것도 아무런 타입 제약이 없으니, 모든 <code>m</code>으로 결정하고, <code>(MonadReader a0 m)</code> 인스턴스가 없다는 No instance 에러가 나면 될 것 같은데, 왜 <code>a0</code>에 먼저 꽂혔을까요? <em>추측</em> 타입 변수 순서대로 풀이resolve를 시도하는게 아닐까 추측합니다.</p>
<p>세 번째 에러는 첫 번째와 같은 종류로 <code>(MonadIO m)</code>이 없다는 에러고,<br />
네 번째 에러는 두 번째와 같은 종류로 <code>(Show a0)</code>의 <code>a0</code>가 모호하다는 에러입니다.</p>
<p>GHC가 <code>a0</code>가 모호하지 않도록, 타입을 지정해 보겠습니다. 패턴 매칭할때 타입을 써주려면 <code>ScopedTypeVariable</code> 확장을 켜야 합니다. 참고 - <a href="../extensions/2020-07-11-ScopedTypeVariables.html">확장 ScopedTypeVariables</a></p>
<div class="sourceCode" id="cb3"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="ot">{-# LANGUAGE ScopedTypeVariables #-}</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="op">...</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="ot">  a ::</span> <span class="dt">Int</span> <span class="ot">&lt;-</span> ask <span class="co">-- 패턴에 타입 지정</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>    • <span class="dt">No</span> <span class="kw">instance</span> for (<span class="dt">MonadReader</span> <span class="dt">Int</span> m) arising from a use <span class="kw">of</span> ‘ask’</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    • <span class="dt">In</span> a stmt <span class="kw">of</span> a 'do' block<span class="op">:</span><span class="ot"> a ::</span> <span class="dt">Int</span> <span class="ot">&lt;-</span> ask</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="dv">10</span> <span class="op">|</span><span class="ot">   a ::</span> <span class="dt">Int</span> <span class="ot">&lt;-</span> ask</span></code></pre></div>
<p><code>a0</code>가 모호하지 않게 <code>Int</code>로 알려주니, 이제 예상했던 No instance 에러가 납니다.</p>
<p>그럼 위의 에러들의 해결책은 뭘까요? No instance라 했으니, 인스턴스를 정의하면 해결될 것 같은 메시지입니다. 하지만, “모든 <code>m</code>”타입의 인스턴스는 정의할 수 없습니다. 애시당초 클래스와 인스턴스는 ad hoc 다형성 스타일 요소로 특정 타입을 위한 동작을 정의할 때 씁니다. 이제 여기서 <em>진짜 타입 추론의 목적</em>이 드러납니다. 사실 <code>ask</code>와 <code>liftIO</code>는 모든 타입에 쓸 수 있는 메소드들이 아닙니다. 그러니, 나중에 <code>m</code>으로 이들을 쓸 수 없는 타입이 들어오게 내버려 두면 당연히 문제가 생깁니다. <em>함수 서명만 보고도 안전하게 조립</em>할 수 있도록 안전 장치를 해두어야 합니다. (모든 타입이란 말이 헛갈리지 않게 <code>forall</code> 타입이라 표현하겠습니다.) <code>forall m</code>타입을 위한 인스턴스가 없다는 말은, <code>forall m</code>을 위한 인스턴스를 만들어서 해결하는게 아니라, <code>forall m</code> 타입을 인스턴스가 있을만한 타입으로 바꾸어서 해결합니다. 해결책은 바로 constraint입니다.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="dt">Control.Monad.Reader</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="ot">func1 ::</span> (<span class="dt">MonadIO</span> m, <span class="dt">MonadReader</span> c m, <span class="dt">Show</span> c) <span class="ot">=&gt;</span> m ()</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>func1 <span class="ot">=</span> <span class="kw">do</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  a <span class="ot">&lt;-</span> ask</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  liftIO <span class="op">$</span> <span class="fu">print</span> a</span></code></pre></div>
<p><code>do</code> 구문은 <code>bind</code> 함수가 가려져 있는데, <code>MonadIO</code> 인스턴스라면 <code>bind</code> 함수가 있을테니 지금 당장 구체 타입은 모르더라도 나중에 만나게 될 컨텍스트가 <code>MonadIO m =&gt;</code> 타입이기만 하면 됩니다. <code>forall m</code> 타입을 위한 인스턴스가 없으니, 나중에 구체 타입을 알아야 할 때가 오면 <code>MonadIO m =&gt;</code> 타입의 인스턴스를 꼭 환인해서 조립하란 표시입니다. 마찬가지로, <code>ask</code>를 쓰고 있으니, <code>MonadReader</code> 클래스의 인스턴스여야 하고, <code>print</code>를 쓰고 있으니 <code>Show</code> 클래스의 인스턴스여야 합니다. <code>forall m</code>타입을 <code>(MonadIO, MonadReader, Show) =&gt;</code> 타입으로 바꾸어 해결했습니다.</p>
<p>해결책을 정리하면<br />
No instance 에러가 났다면, 진짜 필요한 인스턴스 정의가 없거나, <em>대상 타입이 잘 못 지정됐을 수 있습니다.</em><br />
예) <code>MonadIO m =&gt;</code> 타입이어야 하는데 <code>forall</code> 타입으로 되어 있다.</p>
<p>※ mtl 스타일 참고 - <a href="../posts/2020-07-16-MonadTransformer.html">모나드 트랜스포머 그리고 mtl</a></p>
<h2 id="couldnt-match-type---하나의-대상이-두-가지-이상의-형태로-추론-됐다.">Couldn’t match type - 하나의 대상이 두 가지 이상의 형태로 추론 됐다.</h2>
<div class="sourceCode" id="cb6"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="dt">Control.Monad.Trans.Reader</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="dt">Control.Monad.IO.Class</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="ot">someFunc ::</span> m ()</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>someFunc <span class="ot">=</span> <span class="kw">do</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  a <span class="ot">&lt;-</span> ask</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  liftIO <span class="op">$</span> <span class="fu">print</span> a</span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>    • <span class="dt">Couldn't</span> match <span class="kw">type</span> ‘m’ with ‘<span class="dt">ReaderT</span> a0 m0’ <span class="co">---- (1)</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>      ‘m’ is a rigid <span class="kw">type</span> variable bound by <span class="co">----------- (2)</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>        the <span class="kw">type</span> signature for<span class="op">:</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="ot">          func1 ::</span> <span class="kw">forall</span> (<span class="ot">m ::</span> <span class="op">*</span> <span class="ot">-&gt;</span> <span class="op">*</span>)<span class="op">.</span> m ()</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>      <span class="dt">Expected</span> <span class="kw">type</span><span class="op">:</span> m a0 <span class="co">------------------------------(3)</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>        <span class="dt">Actual</span> <span class="kw">type</span><span class="op">:</span> <span class="dt">ReaderT</span> a0 m0 a0 <span class="co">------------------(4)</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    • <span class="dt">In</span> a stmt <span class="kw">of</span> a 'do' block<span class="op">:</span> a <span class="ot">&lt;-</span> ask          </span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="dt">Couldn't</span> match <span class="kw">type</span> ‘m’ with ‘<span class="dt">ReaderT</span> a0 m0’</span></code></pre></div>
<ol type="1">
<li>“<code>m</code>타입은 서명 <code>forall (m :: * -&gt; *). m ()</code>에 지정된rigid 타입인데, <code>m</code>을 <code>ReaderT</code>와 매치할 수 없다.”</li>
</ol>
<div class="sourceCode" id="cb9"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>      ‘m’ is a rigid <span class="kw">type</span> variable bound by</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>        the <span class="kw">type</span> signature for<span class="op">:</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="ot">          func1 ::</span> <span class="kw">forall</span> (<span class="ot">m ::</span> <span class="op">*</span> <span class="ot">-&gt;</span> <span class="op">*</span>)<span class="op">.</span> m ()</span></code></pre></div>
<ol start="2" type="1">
<li><code>m</code>의 <em>타입 추론을 못해서</em> <code>m</code>으로 남아 있는게 아니라, 서명 <code>forall (m :: * -&gt; *). m ()</code>에서 모든 타입이 될 수 있다고 <em>지정한rigid</em> 타입이라 따로 더 이상 추론하지 않습니다. 여기서 결정된<code>rising</code> 타입은 “<em>어떤 타입이 들어와도 상관 없다</em>”가 아니라 , 반드시 “<em>모든 타입이 다 가능해야 한다</em>”입니다. 여기선 카인드 조건이 들어가 있습니다. 완전히 모든 타입이 아니라 <code>* -&gt; *</code> 카인드인 모든 타입이란 뜻입니다.</li>
</ol>
<p>※ 카인드는 타입 분류입니다. 타입 변수 없이 자체로 타입으로 쓰일지, 타입 변수 하나를 받아 타입으로 쓰일지… 등에 따라 타입을 분류해 놓은 겁니다. Int는 <code>*</code> 카인드이고, Maybe는 <code>* -&gt; *</code> 카인드입니다.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>      <span class="dt">Expected</span> <span class="kw">type</span><span class="op">:</span> m a0</span></code></pre></div>
<ol start="3" type="1">
<li>그래서 <code>forall m</code> 타입이 와야하는데,</li>
</ol>
<div class="sourceCode" id="cb11"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a> <span class="dt">Actual</span> <span class="kw">type</span><span class="op">:</span> <span class="dt">ReaderT</span> a0 m0 a0</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    • <span class="dt">In</span> a stmt <span class="kw">of</span> a 'do' block<span class="op">:</span> a <span class="ot">&lt;-</span> ask</span></code></pre></div>
<ol start="4" type="1">
<li><code>ask</code>의 결과 타입은 <code>ReaderT a m</code> 이므로, 여기서 결정된 타입은 <code>ReaderT</code> 입니다.</li>
</ol>
<p>정리하면, 단서들을 통해 찾은 결과가 두 가지인데, 이 두가지 <code>forall m</code>과 <code>ReaderT</code>가 매치되지 않는다는 에러입니다.</p>
<h2 id="could-not-deduce---클래스-제약에-필요한-정보가-없어">Could not deduce - 클래스 제약에 필요한 정보가 없어</h2>
<div class="sourceCode" id="cb12"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="ot">someFunc ::</span> (<span class="dt">MonadIO</span> m, <span class="dt">MonadReader</span> r m) <span class="ot">=&gt;</span> m ()</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>someFunc <span class="ot">=</span> <span class="kw">do</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  a <span class="ot">&lt;-</span> ask</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  liftIO <span class="op">$</span> <span class="fu">print</span> a</span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>    • <span class="dt">Could</span> <span class="fu">not</span> deduce (<span class="dt">Show</span> r) arising from a use <span class="kw">of</span> ‘print’</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>      from the context<span class="op">:</span> (<span class="dt">MonadIO</span> m, <span class="dt">MonadReader</span> r m)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>        bound by the <span class="kw">type</span> signature for<span class="op">:</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="ot">                   someFunc ::</span> <span class="kw">forall</span> (<span class="ot">m ::</span> <span class="op">*</span> <span class="ot">-&gt;</span> <span class="op">*</span>) r<span class="op">.</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>                               (<span class="dt">MonadIO</span> m, <span class="dt">MonadReader</span> r m) <span class="ot">=&gt;</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>                               m ()</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="dv">8</span> <span class="op">|</span>   liftIO <span class="op">$</span> <span class="fu">print</span> a</span></code></pre></div>
<p><code>a</code>타입을 다루는 <code>Show</code> 인스턴스가 있어야 하는데, <code>a</code>타입에 대한 정보가 없습니다.</p>
<p>문장 그대로 읽으면,<br />
<code>Could not deduce (Show r) arising from a use of ‘print’ from the context (MonadIO m, MonadReader r m)</code><br />
<code>print</code> 함수를 쓰려면, <code>r</code>이 <code>Show</code>의 인스턴스여야 하는데, <code>(MonadIO m, MonadReader r m)</code> 컨텍스트만 가지곤 <code>Show</code>를 추론deduce할 수 없다는 뜻입니다.</p>
<ol type="1">
<li>단서로 나온 타입의 인스턴스가 없다. (보통 단서에서 나온 타입이 잘 못 됐다.) - No instance</li>
<li>단서1에서 나온rising 타입 형태와 단서2에서 나온 타입 형태가 맞지 않다. - Couldn’t match</li>
<li>단서에서 나온 클래스의 인스턴스만 쓰겠다는 정보가 Constraint에 없다. - Could not deduce</li>
</ol>
<p>두 번째와 세 번째의 차이는 첫 번째 에러는 <em>m, ReaderT 두 타입의 문제</em>고, 두 번째 에러는 <em>Show 클래스와 r 타입</em>의 문제입니다. Constraint가 없을 때는 deduce 에러는 나지 않고 보통 No Instance 에러가 납니다.</p>
<p>2021.5.15 추가</p>
<p>요약하면</p>
<ol type="1">
<li><p>No instance를 보면<br />
“타입까지 추론 됐다. 하지만 클래스 제약 조건에 맞는 인스턴스가 없는 타입이다.”<br />
“어떤 단서로는 클래스C로 추론했고, 어떤 단서로는 타입A로 추론했는데, 타입A를 키로하는 클래스C의 인스턴스는 없다.”</p></li>
<li><p>Could’t match를 보면<br />
“타입이 두 가지 이상으로 추론됐다.”</p></li>
<li><p>Could not deduce를 보면<br />
“코드에 클래스 제약이 있지만, 추론된 클래스와 관련된 내용이 없다.” (클래스 제약이 있을 때만 나는 에러입니다. 클래스 제약이 없다면 No instance 에러가 나고, 제약이 있긴 있는데 만족스럽지 못하면 Could not deduce 에러가 납니다.)</p></li>
</ol>
<p>단서들로 추론된 결과가 구체 타입까지 추론되어야 하는 건 아닙니다.</p>
<ol type="1">
<li><em>하나의 특정 타입</em>으로 추론될 수도</li>
<li><em>특정 클래스</em> 까지만 추론될 수도 ( 타입 군이라 표현할 수도 있겠습니다.)</li>
<li>아예 <em>모든 타입</em>으로 추론될 수도 있습니다. ( 조건에 따라 다른 타입으로 변한다는 뜻이 아닙니다. 모든 타입을 처리할 수 있어야 한다는 말입니다.)</li>
</ol>
<p>※ 거듭 강조하지만, 3번도 추론이 끝난 상태입니다.</p>

<div class="comment">
  <script>
    document.addEventListener('DOMContentLoaded', loadUtterances, { once: true });
  </script>
</div>
<div style="text-align:right">Github 계정이 없는 분은 메일로 보내주세요. lionhairdino at gmail.com </div>

  </div>
  <nav class="toc toc-right js-toc relative z-1 transition--300 absolute pa4 pt5 is-position-fixed"></nav>
  <script>
    tocbot.init({
      tocSelector: '.js-toc',
      contentSelector: '.js-toc-content',
      headingSelector: 'h2, h3',
      hasInnerContainers: true,
    });
  </script>
  <div id="footer">
    © 2025 lionhairdino. All rights reserved. Generated by <a href="http://jaspervdj.be/hakyll">Hakyll</a>
  </div>
  <script language="javascript">
    const observer = new IntersectionObserver(entries => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add("visible");
        }
      });
    },{
      root: null,
      rootMargin: "0px 0px -30% 0px",
      threshold: 0.5
    });
    document.querySelectorAll('em').forEach(elem => {
      observer.observe(elem);
    })
  </script>

</body>

</html>
