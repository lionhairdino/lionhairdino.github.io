<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ko" lang="ko">

<head>
  <script>
    (function () {
      const savedTheme = localStorage.getItem('theme');
      if (savedTheme === 'dark') {
        document.documentElement.classList.add('dark-mode');
        console.log(savedTheme);
      }
    })();

    function loadUtterances() {
      const savedTheme = localStorage.getItem('theme') || 'light';
      const themeValue = savedTheme === 'dark' ? 'github-dark' : 'github-light';

      const script = document.createElement('script');
      script.src = 'https://utteranc.es/client.js';
      script.setAttribute('repo', 'lionhairdino/lionhairdino.github.io');
      script.setAttribute('issue-term', 'url');
      script.setAttribute('theme', themeValue); // 동적으로 테마 설정
      script.setAttribute('crossorigin', 'anonymous');
      script.async = true;

      document.body.appendChild(script);
    };

    function updateUtterancesTheme() {
      const savedTheme = localStorage.getItem('theme') || 'light';
      const themeValue = savedTheme === 'dark' ? 'github-dark' : 'github-light';

      // Utterances iframe에 메시지 전송
      const utterances = document.querySelector('.utterances iframe');
      if (utterances) {
        utterances.contentWindow.postMessage(
          {type: 'set-theme', theme: themeValue},
          'https://utteranc.es'
        );
      }
    }

  </script>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>lionhairdino - Vim + Haskell Language Server</title>
  
  <meta name="description" content="lionhairdino - Vim + Haskell Language Server" />
  <meta property="og:description" content="하스켈 함수형 프로그래밍" />
  
  <link rel="stylesheet" type="text/css" href="../css/default.css" />
  <link rel="icon" href="https://lionhairdino.github.io/favicon.svg" />
  <link rel="icon" type="image/png" href="../images/favicon/Lionhairdino16px.png" sizes="16x16" />
  <link rel="icon" type="image/png" href="../images/favicon/Lionhairdino24px.png" sizes="24x24" />
  <link rel="icon" type="image/png" href="../images/favicon/Lionhairdino32px.png" sizes="32x32" />
  <link rel="icon" type="image/png" href="../images/favicon/Lionhairdino48px.png" sizes="48x48" />
  <link rel="icon" type="image/png" href="../images/favicon/Lionhairdino57px.png" sizes="57x57" />
  <link rel="icon" type="image/png" href="../images/favicon/Lionhairdino60px.png" sizes="60x60" />
  <link rel="icon" type="image/png" href="../images/favicon/Lionhairdino64px.png" sizes="64x64" />
  <link rel="icon" type="image/png" href="../images/favicon/Lionhairdino72px.png" sizes="72x72" />
  <link rel="icon" type="image/png" href="../images/favicon/Lionhairdino76px.png" sizes="76x76" />
  <link rel="icon" type="image/png" href="../images/favicon/Lionhairdino114px.png" sizes="114x114" />
  <link rel="apple-touch-icon-precomposed" href="../images/favicon/Lionhairdino120px.png" sizes="120x120" />
  <link rel="apple-touch-icon-precomposed" href="../images/favicon/Lionhairdino144px.png" sizes="144x144" />
  <link rel="shortcut icon" href="../favicon.ico" />
  <link rel="apple-touch-icon-precomposed" href="../images/favicon/Lionhairdino152px.png" sizes="152x152" />
  <link rel="apple-touch-icon-precomposed" href="../images/favicon/Lionhairdino180px.png" sizes="180x180" />
  <link rel="icon" type="image/png" href="../images/favicon/Lionhairdino192px.png" sizes="192x192" />
  <link rel="manifest" href="../site.webmanifest" />
  <link rel="mask-icon" href="https://lionhairdino.github.io/Lionhairdino_black.svg" color="#ff7500" />
  <meta name="msapplication-TileImage" content="/images/favicon/Lionhairdino144px.png" />
  <meta name="msapplication-TileColor" content="#ff7500" />
  <meta name="theme-color" content="#ffffff" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="Vim + Haskell Language Server" />
  <meta property="og:site_name" content="Lionhairdino" />
  <meta property="og:url" content="https://lionhairdino.github.io/posts/2022-07-02-vim.html" />
  
  <meta property="og:image" content="https://lionhairdino.github.io/images/vim_hls.png" />
  
  
  <meta name="keywords" content="Vim, HLS, Neovim, LSP, Language Server Protocol, Coc, haskell, 하스켈, 함수형, Functional">
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-E9WZ6VXGHP"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() {dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-E9WZ6VXGHP');
  </script>
  <script src="../script/copycode.js"></script>

  <script src="../script/darkmode.js"></script>
  <script async src="https://cse.google.com/cse.js?cx=9c53b4915cbb2605c"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.11.1/tocbot.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.11.1/tocbot.css" />
  <meta name="fediverse:creator" content="@lionhairdino@mastodon.social" />
  <link rel="alternate" type="application/rss+xml" title="상상 하스켈 - Lionhairdino" href="rss.xml" />
</head>

<body>
  <div id="header">
    <div style="display:inline-block;margin-right:5px;padding-top: 5px;" id="logo">
      <a href="../"><img style="width:30px;border:none" src="../images/favicon/Lionhairdino48px.png"></a>
    </div>
    <div style="display:inline-block;vertical-align: top;padding-top:5px;" id="navigation">
      <a href="../">lionhairdino</a>
      <a href="../about.html">about</a>
      <!--<a href="/archive.html">archive</a>-->
    </div>
    <div style="display:inline-block;font-size:0.8em;vertical-align: top;">
      <div style="display:inline-block;vertical-align: top;padding-top: 5px"></div>
      <div style="display:inline-block;vertical-align: top;padding-top: 11px; padding-left: 10px;"><a rel="me" href="https://mastodon.social/@lionhairdino"><img style="width:20px;border:none" src="../images/mastodon.svg"></a></div>
      <div style="display:inline-block;vertical-align: top;padding-top: 11px; padding-left: 2px;"><a href="https://lionhairdino.bsky.social"><img style="width:18px;border:none" src="../images/bluesky.svg"></a>
      </div>
      <div style="display:inline-block;vertical-align: top;padding-top: 11px; padding-left: 2px;"><a href="https://discordapp.com/users/lionhairdino#7687"><img style="width:20px;border:none" src="../images/discord.svg"></a></div>
      <div style="display:inline-block;vertical-align: top;padding-top: 11px; padding-left: 2px;"><a href="https://x.com/lionhairdino"><img style="width:15px;border:none" src="../images/X.svg"></a></div>
      <div style="display:inline-block;vertical-align: top;padding-top: 11px; padding-left: 2px;"><a href="https://linkedin.com/in/lionhairdino-l-baaa54244"><img style="width:20px;border:none" src="../images/linkedin.svg"></a></div>
      <div style="display:inline-block;vertical-align: top;padding-top: 11px; padding-left: 2px;"><a href="https://github.com/lionhairdino"><img style="width:20px;border:none" src="../images/github.svg"></a></div>
      <div style="display:inline-block;vertical-align: top;padding-top: 11px; padding-left: 2px;"><a href="https://www.threads.net/@linohairdino"><img style="width:20px;border:none" src="../images/threads.svg"></a></div>
    </div>
    <div>
      <div style="display:inline-block;width:180px;">
        <div class="gcse-searchbox-only"></div>
        <div><button id="theme-toggle">
            <script>
              const savedTheme = localStorage.getItem('theme');
              if (savedTheme === 'dark')
                document.write("☉");
              else
                document.write("☾");
            </script>
          </button></div>
      </div>
    </div>
    <div>
      여기 글들은 일종의 질문입니다. 용어 선택도 학계, 업계에서 쓰는 걸로 되어 있지 않고, 틀린 내용이 있을 수도 있습니다. 여기 글을 처음 읽는 분은, 먼저 <a href="warning.html">주의문</a>을 꼭 읽어보세요.
    </div>
  </div>
  <div class="js-toc-content">
    <h1>Vim + Haskell Language Server</h1>
    <link rel="stylesheet" type="text/css" href="../css/syntax.css" />
<div class="info">
    Posted on July  2, 2022
    
</div>

<p>저는 nn년 전부터 시스템 관리를 위해 <code>Vim</code>을 써오고 있고 한동안 순정 <code>Vim</code>으로 아무 생각없이 써왔습니다. 그리고 하스켈을 공부하면서 부터는 <code>vscode</code>를 주로 썼습니다. 간단한 편집 기능키들은 손에 익은 <code>Vim</code>모드로 해놓고 별 불만없이 썼습니다. 전 완전 키보드파는 아니라, 마우스가 전혀 작동하지 않는 환경은 오히려 좀 답답합니다. <code>Vim</code>을 하스켈의 메인 편집 툴로 쓸 생각은 안하고 있던 차에, 우연히 다른 분의 <code>Vim</code> 문제를 도우려 살펴 보다 보니, nn년 전에 비하면 설정이 굉장히 쉬워져서, <code>Vim</code>에 제대로 <code>Haskell</code> 셋팅을 시도하게 됐습니다. 아래는 현재2022 제가 쓰고 있는 설정들인데, 플러그인들은 계속 발전하고 있으니 최신 정보들을 확인하세요.</p>
<p>2023.2.6 추가<br />
<a href="https://discord.gg/TwaYqgtQYf"><strong>한국 빔 사용자 그룹 Korean Vim User Group</strong></a> 디스코드가 새로 생겼습니다. Vim을 실무에 쓰고 계신 많은 분들이, 각자의 <code>dot</code>파일들과 노하우도 공유하고, 질문 수준에 관계없이 친절하게들 답해주십니다. 지금은 꼭 Vim관련 된 게 아니더라도, 유용한 개발 정보들을 주고 받고 있습니다.</p>
<h2 id="neovim">Neovim</h2>
<p><code>vi</code>를 쓴다 하면 대부분 <code>vi</code>에서 확장된 <code>vim</code>을 의미하지 않나요? 그리고 <code>vim</code>을 그래픽컬하게 쓰기 위해 <code>GUI</code>를 입힌 <code>gvim</code>, <code>spacevim</code>, <code>oni</code>등 있는데, 저는 터미널에서 가장 빠르게 부트업 되는 <code>vi</code>를 버릴 수가 없어 <code>neovim</code>을 선택했습니다. <code>vim</code>과의 차이점은 여러 가지가 있는데, 제가 체감하는 정도는 <code>Lua</code> 스크립트 내장으로 퍼포먼스가 올라간 게 가장 큰 차이점이 아닐까 합니다. 시스템 설정 파일들을 주로 만지는 분들은 <code>vim</code>과 <code>neovim</code>이 큰 차이가 있어 보이지 않을 수 있는데, 프로그래머가 메인 툴로 쓰려면 이제는 <code>neovim</code>으로 넘어가는 게 편할 것 같습니다. (케케묵은 <code>vi</code>와 <code>emacs</code> 논쟁을 얘기 하고 싶은게 아니라, 이미 <code>vi (vim)</code>을 쓰시는 분들 얘기입니다.)</p>
<p>참고 : <a href="https://alpha2phi.medium.com/learn-neovim-the-practical-way-8818fcf4830f#545a">Learn Neovim The Practical Way</a></p>
<h4 id="프리셋">프리셋</h4>
<p><a href="https://github.com/rockerBOO/awesome-neovim#preconfigured-configuration" class="uri">https://github.com/rockerBOO/awesome-neovim#preconfigured-configuration</a><br />
아래에 나올 설정이나, 플러그인 설정을 직접하지 않아도, 미리 잘 셋팅된 프리셋 neovim들이 여러가지 있습니다. <a href="https://github.com/AstroNvim/AstroNvim">AstroNvim</a>, <a href="https://github.com/CosmicNvim/CosmicNvim">CosmicNvim</a>, <a href="https://github.com/NvChad/NvChad">NvChad</a>, <a href="https://github.com/doom-neovim/doom-nvim">Doom Nvim</a>, <a href="https://github.com/LunarVim/LunarVim">Lunarvim</a> 등, 고생없이 바로 깔끔한 환경을 만날 수 있는 것들이 있습니다.</p>
<p>전 의도적으로 pre-configured를 피한 건 아닌데, 어찌 하다보니 하나 하나 다 설치해서 쓰고 있습니다. 분명 제 셋팅보다 더 깔끔하게 돌아가는 프리셋들이 많은데, 제 손때가 묻어서 그런지 그냥 쓰게되네요. 수 백 개의 부품(plugin, 설정)들 중 조합해서 만드는 프라모델 느낌도 있습니다. 어렸을 때는 그다지 프라모델 조립같은 건 좋아하진 않았는데, 지금은 일이 손에 안잡힐 때, 잘 가지고 놉니다.</p>
<h4 id="vimscript를-대체-하는-임베드-스크립트-lua">VimScript를 대체 하는 임베드 스크립트 Lua</h4>
<p><a href="https://github.com/henriquehbr/lua-vs-vimscript">벤치마크</a> 결과만 보면 압도적이긴 한데, 항상 그럴지는 아직 모르겠습니다.</p>
<h4 id="마우스-설정">마우스 설정</h4>
<p>전 완벽하게 키보드만 쓰는 스타일은 아니고, 창pane 크기 조절, 텍스트 선택 등은 마우스가 편합니다. 아마도 최소한의 마우스 기능이 지원되지 않았으면 <code>vscode</code>를 썼을지도 모르겠습니다. 추가로 다른 앱과 복사, 붙이기를 위해 시스템 클립 보드를 사용하도록 설정합니다.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>set mouse=a &quot; 마우스로 창 크기 조절, 탭 선택 등..</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>set clipboard+=unnamedplus &quot; 시스템 클립보드 쓰기</span></code></pre></div>
<blockquote>
<p>[Vim 플러그인 설치 과정]<br />
2023-10-31 현재는 플러그인 매니저로 <a href="https://github.com/folke/lazy.nvim">Lazy</a>를 권장하는 추세입니다. lazy 로딩으로 필요할 때 올리니, neovim 부트업 속도를 개선할 수 있습니다.</p>
<p>지정된 폴더에 소스를 받아 넣어놔도 되지만, 지금은 대부분 플러그인 매니저를 이용합니다. 여기선 <a href="https://github.com/junegunn/vim-plug">vim-plug</a>를 기준으로 설명합니다.</p>
<ol start="0" type="1">
<li><p>플러그인 매니저 설치는 각 매니저들의 가이드에 따라 설치하시고,</p></li>
<li><p>플러그인을 개발하는 github 홈페이지를 찾습니다.</p></li>
<li><p>설정 파일(<code>init.vim</code>)에서 아래와 같은 위치에 github 계정과 repository를 넣어줍니다.<br />
(설정 파일 위치는 <code>:echo stdpath("config")</code>로 찾을 수 있습니다.)</p>
<pre class="vim"><code>call plug#begin()
Plug 'junegunn/fzf'</code></pre></li>
<li><p>설정 파일을 <code>vim</code>이 인식하도록</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>:source %</span></code></pre></div>
<p>를 하거나, <code>vim</code>을 재시작 합니다.</p></li>
<li><p>그 후 아래 명령을 통해 플러그인을 설치합니다.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>:PlugInstall</span></code></pre></div></li>
<li><p>플러그인에 필요한 설정들을 추가합니다.
역시 설정 파일을 vim이 인식하도록 <code>:source %</code>를 해주거나 재시작합니다. <code>%</code>는 현재 파일의 처음부터 끝까지의 내용, 즉 파일 전체를 의미합니다. 파일 전체를 읽어 설정 파일에 적용하란 의미입니다. ※ 명령행command-line에서는 다른 뜻입니다. <code>:!echo %</code> 하면 현재 파일명을 의미하고, 여기에 파일명 modifier중 <code>:h</code>를 붙이면, 현재 파일이 있는 디렉토리를 의미합니다.(<code>:help %:h</code>로 도움말을 볼 수 있습니다.)</p></li>
<li><p>설치 확인 방법<br />
플러그인이 설치된게 자동으로 눈에 보이는 류의 플러그인이 아닐 경우</p></li>
</ol>
<ul>
<li><code>:Telescope</code> 같은 대문자로 시작하는 관련 명령어들이 생깁니다. 적당히 앞글자 치면서 <code>&lt;tab&gt;</code>을 누르면 가용한 명령어들을 보여줍니다. 또는 <code>:command</code>로 전체 명령어를 볼 수 있습니다.</li>
<li>특정 이벤트에 따라 자동으로 활성화 되는 플러그인인 경우 <code>:autocmd</code>를 이용해 이벤트별 등록된 기능 목록을 볼 수 있습니다.</li>
<li><code>:verbose map &lt;C-space&gt;</code> 같은 식으로 단축키 목록을 볼 수 있습니다. <code>map</code>부분을 <code>imap</code>, <code>nmap</code>등으로 모드별 지정 단축키를 볼 수 있습니다. <code>verbose</code>를 붙여야만 중복 정의로 덮어 씌워지는 게 있는지 확인 할 수 있습니다.</li>
</ul>
</blockquote>
<h3 id="plugin---nerdtree">Plugin - NerdTree</h3>
<p>예전엔 <a href="https://github.com/preservim/nerdtree"><code>NerdTree</code></a> 외에는 대안이 없었던 것 같은데 요즘은 <a href="https://github.com/nvim-neo-tree/neo-tree.nvim"><code>NeoTree</code></a>를 선택하는 프리셋들이 종 종 보입니다. <code>Lua</code>로 개발되어 좀 더 퍼포먼스가 좋고, 폰트와 이미지 활용이 더 깔끔합니다만, 아직 폴더 즐겨 찾기가 지원 되지 않아, 아직은 <code>NerdTree</code>를 쓰고 있습니다.</p>
<p>2022.11.13<br />
<a href="https://github.com/nvim-tree/nvim-tree.lua">Nvim-tree</a>로 바꿨습니다. 성능면에선 파이썬으로 만든 <a href="https://github.com/ms-jpq/chadtree">CHADTree</a>가 나아 보이기도 했는데, 다른 플러그인들이 기본적으로 <code>Nvim-tree</code>를 지원하는 것들이 종종 있습니다. 마치 지금은 neovim 생태계에서 defacto처럼 쓰이고 있는 듯 한데, <code>CHADTree</code>의 간결함이 분발한다면 또 모르지요.</p>
<h3 id="plugin---auto-session">Plugin - Auto-session</h3>
<p><a href="https://github.com/rmagatti/auto-session" class="uri">https://github.com/rmagatti/auto-session</a><br />
여러 윈도우로 나눠놓고 작업하다 <code>:qa</code>로 종료하고 나서, 다시 열면 원래 작업하던 상태로 돌아가기 위해 사용합니다.</p>
<h3 id="plugin---neoterm">Plugin - Neoterm</h3>
<p><a href="https://github.com/kassio/neoterm" class="uri">https://github.com/kassio/neoterm</a><br />
입력 모드로 들어가서 터미널을 사용하는 것 까진 매뉴얼 없이 자연스럽게 되는데, 터미널을 벗어나는 키는 봐 둘 필요가 있습니다. 디폴트는 <code>&lt;Ctrl \&gt; &lt;Ctrl n&gt;</code>로 설정되어 있습니다.</p>
<h3 id="plugin---nvim-web-devicons">Plugin - Nvim Web Devicons</h3>
<p><a href="https://github.com/kyazdani42/nvim-web-devicons" class="uri">https://github.com/kyazdani42/nvim-web-devicons</a><br />
텍스트 환경에서 UI를 구현하니, 폰트들의 모양을 이 것 저 것 활용하는데, 이러기 위해서 적당한 <code>Font</code>를 설치해야 합니다.</p>
<h3 id="plugin---tabular">Plugin - tabular</h3>
<p><a href="https://github.com/godlygeek/tabular" class="uri">https://github.com/godlygeek/tabular</a><br />
특정 기호를 기준으로 선택한 텍스트를 정렬할 수 있습니다.</p>
<h3 id="plugin---markdown-preview">Plugin - Markdown preview</h3>
<p><a href="https://github.com/iamcco/markdown-preview.nvim" class="uri">https://github.com/iamcco/markdown-preview.nvim</a><br />
마크다운 작성하는 동안 브라우저와 연동해서 미리보기를 할 수 있습니다.</p>
<h3 id="plugin---fzf">Plugin - FZF</h3>
<p><a href="https://github.com/junegunn/fzf.vim" class="uri">https://github.com/junegunn/fzf.vim</a><br />
퍼지 검색으로 손쉽게 편집할 파일을 찾을 수 있습니다.</p>
<h3 id="plugin---telescope">Plugin - telescope</h3>
<p><a href="https://github.com/nvim-telescope/telescope.nvim" class="uri">https://github.com/nvim-telescope/telescope.nvim</a><br />
팝업창을 띄우는 기능으로, 자체적으로도 여러 기능이 있고, 다른 플러그인과 연동해서 돌아가는 기능도 많습니다.</p>
<h3 id="plugin---fzf-hoogle">Plugin - fzf-hoogle</h3>
<p><a href="https://github.com/monkoose/fzf-hoogle.vim" class="uri">https://github.com/monkoose/fzf-hoogle.vim</a><br />
Hoogle 검색 플러그인</p>
<h3 id="plugin---lualine">Plugin - lualine</h3>
<p><a href="https://github.com/nvim-lualine/lualine.nvim" class="uri">https://github.com/nvim-lualine/lualine.nvim</a><br />
아랫쪽 상태바를 예쁘게 바꿔줍니다.</p>
<h3 id="plugin---lazygit">Plugin - lazygit</h3>
<p><a href="https://github.com/kdheepak/lazygit.nvim" class="uri">https://github.com/kdheepak/lazygit.nvim</a><br />
쉘에서 git을 사용할 때 쓰는 tui인 lazygit을 Telescope에 얹혀서 쓸 수 있습니다.</p>
<h3 id="plugin---iron">Plugin - Iron</h3>
<p>REPL과 소통하는 걸 도와주는 플러그인입니다.<br />
<a href="https://github.com/hkupty/iron.nvim" class="uri">https://github.com/hkupty/iron.nvim</a><br />
</p>
<h3 id="팁---esc-이외의-키를-영문-변환키로-쓰기">팁 - ESC 이외의 키를 영문 변환키로 쓰기</h3>
<p>vim은 modal(모드가 있는) 에디터이므로 편집 모드에서 한글 상태로 작업하다, 모드가 바뀌면 영문 상태로 가는 기능이 있으면 편리합니다. 그래서, 각 종 입력기에는 이를 위해 <code>ESC</code>키를 누르면 영문 상태로 바뀌는 옵션들을 가지고 있습니다. 하지만, 손가락을 경제적으로 쓰기 위해 <code>ESC</code>키보다, 기본 위치에서 가까운 <code>Ctrl [</code>를 쓰는 분들은 이 옵션의 혜택을 받지 못했습니다. 그런데, 최근에 <a href="https://github.com/Riey/kime">KIME</a>를 알게 되어, 셋팅 도중 아래와 같이 테스트하니 <code>Ctrl [</code>도 영문으로 바뀌도록 손쉽게 설정이 가능했습니다.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ~/.config/kime/config.yaml</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 2023-10-31 v3.0 설정 방식으로 수정 </span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co">...</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co">engine:</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co">  default_category: Latin</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co">  global_category_state: false</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co">  global_hotkeys:</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="co">    M-C-Backslash:</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="co">      behavior: !Mode Math</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="co">      result: ConsumeIfProcessed</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="co">    S-Space:</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="co">      behavior: !Toggle</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="co">          - Hangul</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="co">          - Latin</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="co">      result: Consume</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a><span class="co">    M-C-E:</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a><span class="co">      behavior: !Mode Emoji</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="co">      result: ConsumeIfProcessed</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a><span class="co">    Esc:</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a><span class="co">      behavior: !Switch Latin</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a><span class="co">      result: Bypass</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a><span class="co">    C-OpenBracket: #---------------- 추가</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a><span class="co">      behavior: !Switch Latin</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a><span class="co">      result: Bypass</span></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a><span class="co">    C-Space: #---------------------- 추가</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a><span class="co">      behavior: !Switch Latin</span></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a><span class="co">      result: Bypass</span></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a><span class="co">...</span></span></code></pre></div>
<p>다른 입력기들은 셋팅 방법을 몰라, 혹은 사용자에게 드러내 놓지 않아 풀지 못한 문제였는데, 드디어 해결했습니다. 이미 훌륭하지만, 앞으로도 굉장히 기대되는 한글 입력기입니다.</p>
<p>수학에서 자주 쓰이는 기호와 Greek문자들을 입력하는 모드도 있습니다.</p>
<p>기본 수학 모드 변환 키 <code>Ctrl + ALt + \</code></p>
<p>수학 모드 상태에서 <code>\alpha</code>를 입력하면 <code>α</code>가 입력되고, <code>\beta</code>를 입력하면 <code>β</code>가 나오는 방식입니다.<br />
아직 2022년 10월 현재 오피셜한 문서는 따로 없으며, 아래 링크 설명이 유일합니다.<br />
<a href="https://github.com/Riey/kime/issues/583">KIME 수학 기호 입력법 - damhiya</a></p>
<p>※ 저는 한영 변환키로 <code>Shift - Space</code>, 무조건 영문 변환키로 <code>Ctrl - Space</code>를 쓰게 설정하고, 아래를 <code>init.vim</code>에 추가해 <code>ESC</code>키의 대용으로 <code>Ctrl Space</code>를 씁니다. 2022-11-13 : 다른 플러그인들의 기본 설정과 겹치는 부분이 있어, 지금은 <code>Ctrl Space</code>는 따로 설정하지 않고 쓰고 있습니다.</p>
<pre class="vim"><code>if has('nvim')
  tnoremap &lt;C-Space&gt; &lt;Esc&gt;  
endif</code></pre>
<p>2023-10-31 추가<br />
<a href="https://github.com/Riey/kime/releases/tag/v3.0.0">v3.0</a> 이 후부터 config 파일 형식이 일부 바뀌는 breaking 변화가 있습니다.<br />
※ 설정 파일에 오류가 있으면 아무 말 없이 디폴트 설정으로 시작하는 듯 합니다. 이렇게 되면 설정 파일을 읽었는지, 무슨 설정을 잘 못한 게 있는지 알 도리가 없습니다. 전 소리 소문없이 잠행하는 동작은 언젠가 문제를 일으킨다고 생각합니다. 다행히, 체크해 볼 방법은 마련해 뒀습니다. kime를 설치할 때 <code>kime-check</code> 유틸이 같이 설치되고, 이 툴로 설정 파일이 문제 없는지 확인할 수 있습니다.</p>
<h2 id="language-server-protocol-client">Language Server Protocol Client</h2>
<figure>
<img src="../images/neovim_lsp.png" alt="Neovim + HLS" />
<figcaption aria-hidden="true">Neovim + HLS</figcaption>
</figure>
<p>가장 흔한 설정이 아래 4가지로 보입니다.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>1.    Vim -&gt; 플러그인 Coc                   ------ LSP -----&gt; HLS</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>2. Neovim -&gt; 빌트인 LSP 클라이언트          ------ LSP -----&gt; HLS</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>3. Neovim -&gt; 플러그인 LanguageClient-neovim ------ LSP -----&gt; HLS</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>4. Neovim -&gt; 플러그인 Coc                   ------ LSP -----&gt; HLS</span></code></pre></div>
<p><code>Neovim</code>을 <code>LSP</code>서버와 붙이려면 많이 쓰는 방식은 빌트인 되어 있는 <code>Native LSP Client</code>, <code>Vim</code>과 호환되는 <code>Coc</code> 또는 <code>LanguageClient</code> 플러그인을 씁니다. 저는 이 중 <code>Coc</code>를 선택했습니다. <code>Vim + LSP</code> 관련 내용을 서핑으로 찾아 볼 때, 어떤 플러그인 글인가 자세히 보셔야 합니다.</p>
<h3 id="빌트인-lsp">빌트인 LSP</h3>
<p><a href="https://smarttech101.com/nvim-lsp-autocompletion-mapping-snippets-fuzzy-search/">Nvim lsp autocompletion: mapping, snippets, fuzzy search</a></p>
<h3 id="coc">Coc</h3>
<p>※ 2023-10-31 추가: 현재, 아직도 많이 쓰이기는 한데, 저는 빌트인으로 갈아 탔습니다.</p>
<p><a href="https://github.com/neoclide/coc.nvim" class="uri">https://github.com/neoclide/coc.nvim</a>
이 전에는 꽤 여러개의 플러그인을 동원해서 IDE스러운 설정들을 했었던 것 같은데, 지금은 <code>LSP</code> 클라이언트와 각 언어에 맞는 Language Server를 띄워서 붙이면 어지간한 IDE 동작들은 다 하는 것 같습니다.</p>
<h4 id="lsp-클라이언트자동-완성audo-completion-포함-플러그인-설치">LSP 클라이언트(자동 완성audo-completion 포함) 플러그인 설치</h4>
<p>여러가지 방법이 있는데, 여기서는 <code>coc</code>를 선택했습니다.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>Plug 'neoclide/coc.nvim', {'branch': 'release'}</span></code></pre></div>
<h3 id="haskell-language-server-이하-hls">Haskell Language Server (이하 HLS)</h3>
<p>에디터들이 <code>LSP</code> (Language Server Protocol)에 맞춰 요청을 보내면, 이를 받아 언어 컴파일러나 기타 툴의 도움을 받아 필요한 정보를 돌려주는 툴을 Language Server라 합니다. 하스켈 생태계에서 에디터들의 IDE스런 동작을 도와주는 여러 툴들이 있었는데, 지금은 거의 <a href="https://haskell-language-server.readthedocs.io/en/latest/index.html">Haskell Language Server</a>로 흡수 및 통일 된 것 같습니다.</p>
<p><code>GHC</code>, <code>Stack</code>, <code>Cabal</code>, <code>HLS</code>를 설치할 때, 지금(2022) 가장 권장되는 방식은 <code>ghcup</code>를 이용하는 방식인 듯 합니다.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="ex">ghcup</span> tui</span></code></pre></div>
<p>실행 경로가 잘 잡혀있고 정상 동작하는지 확인하기 위해 아래로 확인</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> haskell-language-server-wrapper</span></code></pre></div>
<h3 id="coc와-hls-연결">Coc와 HLS 연결</h3>
<p>아래 명령어를 입력해서 <code>Coc</code>설정 파일을 엽니다.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>:CocConfig</span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;coc.preferences.extensionUpdateCheck&quot;</span><span class="fu">:</span> <span class="st">&quot;daily&quot;</span><span class="fu">,</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;languageserver&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;haskell&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;command&quot;</span><span class="fu">:</span> <span class="st">&quot;haskell-language-server-wrapper&quot;</span><span class="fu">,</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;args&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="st">&quot;--lsp&quot;</span><span class="ot">]</span><span class="fu">,</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;rootPatterns&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;stack.yaml&quot;</span><span class="ot">,</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;*.cabal&quot;</span><span class="ot">,</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;cabal.config&quot;</span><span class="ot">,</span>    </span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;package.yaml&quot;</span><span class="ot">,</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;hie.yaml&quot;</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>      <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;filetypes&quot;</span><span class="fu">:</span> <span class="ot">[</span> <span class="st">&quot;hs&quot;</span><span class="ot">,</span> <span class="st">&quot;lhs&quot;</span><span class="ot">,</span> <span class="st">&quot;haskell&quot;</span> <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;initializationOptions&quot;</span><span class="fu">:</span> <span class="fu">{</span> <span class="dt">&quot;languageServerHaskell&quot;</span><span class="fu">:</span> <span class="fu">{}</span> <span class="fu">}</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">}</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">},</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;suggest&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;disableKind&quot;</span><span class="fu">:</span> <span class="kw">true</span><span class="fu">,</span>    </span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;snippetsSupport&quot;</span><span class="fu">:</span> <span class="kw">false</span>    </span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">},</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;diagnostic&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;virtualText&quot;</span><span class="fu">:</span> <span class="kw">true</span><span class="fu">,</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;virtualTextCurrentLineOnly&quot;</span><span class="fu">:</span> <span class="kw">false</span><span class="fu">,</span>    </span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;virtualTextLines&quot;</span><span class="fu">:</span> <span class="dv">1</span><span class="fu">,</span></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;virtualTextPrefix&quot;</span><span class="fu">:</span> <span class="st">&quot; —— &quot;</span></span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">},</span></span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;list.height&quot;</span><span class="fu">:</span> <span class="dv">20</span><span class="fu">,</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;codeLens.enable&quot;</span><span class="fu">:</span> <span class="kw">true</span><span class="fu">,</span></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;coc.preferences.enableMarkdown&quot;</span><span class="fu">:</span> <span class="kw">true</span><span class="fu">,</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;coc.preferences.jumpCommand&quot;</span><span class="fu">:</span> <span class="st">&quot;tab drop&quot;</span>    </span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span> </span></code></pre></div>
<p><code>vim</code>도 설정 파일 위치만 다를 뿐 똑같은 절차로 동작합니다.</p>
<h3 id="사용-방법">사용 방법</h3>
<p>예전엔 <code>tmux</code>로 <code>ghcid</code>를 별도로 띄워놓고 작업하는 경우가 많았는데, 요즘은 많이들 <code>HLS</code>로 넘어가고 있는 것 같습니다. <code>ghcid</code>를 보듯 창을 띄우려면 아래 명령어를 이용합니다.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>:CocDiagnostics</span></code></pre></div>
<p>아직 이유를 제대로 알지 못하는 오작동 경우가 종종 있는데, 재시작으로 해결해야 하는 경우가 많습니다. 아래 명령어를 입력하거나, 단축키를 지정해 놓고 쓰는 것을 추천드립니다.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>:CocRestart</span></code></pre></div>
<p><code>init.vim</code>에 단축키 설정</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>map &lt;F10&gt; :CocRestart&lt;CR&gt;</span></code></pre></div>
<p><code>:Coc</code>까지 입력하고 <code>tab</code>키를 입력하면 지원 명령들을 볼 수 있습니다.<br />
지원하는 명령들을 목록으로 볼 수도 있습니다.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>:CocList</span></code></pre></div>
<p>아래 명령을 이용하여 <code>LSP</code> 서버에게 여러가지 명령을 전달 할 수 있습니다.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>:CocCommand</span></code></pre></div>
<h3 id="정의로-점프go-to-definition-후-돌아-오기가-안될-때">정의로 점프Go to Definition 후 돌아 오기가 안될 때</h3>
<p>2022.10.28 추가</p>
<ul>
<li><code>Ctrl i</code>, <code>Ctrl o</code>는 점프리스트를 순환하는 키로, 점프한 지점이 바로 다음 값이 아니면 직관적이지 않게 꼬입니다.</li>
<li>새 탭을 열며 Definition으로 갔는데, <code>Ctrl o</code>를 누르면, 이전 탭으로 가는게 아니라 현재 탭에서 파일을 다시 여는 동작을 합니다.</li>
</ul>
<p>위 두가지 이유로 <code>Ctrl o</code>는 적합하지 않습니다.</p>
<p>해결책은 tag시스템을 이용하는 방법입니다.</p>
<p><code>.config/nvim/init.vim</code></p>
<pre class="vim"><code>set tagfunc=CocTagFunc</code></pre>
<p>설정을 마치고 vim을 다시 시작하면,<br />
<code>gd</code>또는 <code>Ctrl ]</code>로 정의 위치로 점프하고, <code>Ctrl T</code>로 다시 돌아올 수 있습니다.</p>
<h3 id="윙맨wingman">윙맨Wingman</h3>
<p><code>HLS</code>는 다양한 기능들을 플러그인 구조로 구현하고 있습니다. 이 중 타입만 작성하고 hole<code>_</code>을 써 놓으면 코드를 추정해 주는 <a href="https://hackage.haskell.org/package/hls-tactics-plugin">Wingman</a>이란 플러그인이 있는데, 아직은 익숙하지 않은데, 원리를 좀 더 이해한다면 강력한 툴 중 하나가 될지도 모릅니다. 윙맨 플러그인은 <code>HLS</code>를 설치할 때 디폴트로 설치 됩니다.</p>
<h3 id="설정-오류를-고칠-단서-얻는-방법">설정 오류를 고칠 단서 얻는 방법</h3>
<p>이 소스, 저 소스들을 가져와서 실행해 보며 공부하다 보면, 버전 충돌로 인한 에러를 자주 만납니다. 작동을 제대로 하고 있는지 보는 방법 중 가장 간단한 방법은 HLS 프로세스가 떠있나 보는 방법이 있고, 아래 명령어들을 이용해 단서를 얻을 수 있습니다.</p>
<p>꽤 오랫동안 인터넷 문서들을 보며 리눅스 관련 툴들을 설치하곤 했는데, 그 때마다 드는 생각이 “현재 잘 작동하고 있는지, 로그는 어떻게 보는지” 알려주는 문서가 제일 좋았던 것 같습니다.</p>
<p>Neovim 안에서</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>:CocCommand workspace.showOutput</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>:CocOpenLog</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>:messages</span></code></pre></div>
<p>프로젝트 루트 폴더에서(stack.yaml이 있는 폴더) 커맨드 라인에서</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> haskell-language-server-wrapper</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> haskell-language-server-9.0.2 <span class="kw">(</span><span class="ex">특정</span> 버전<span class="kw">)</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> stack <span class="ex">build</span> <span class="at">--verbose</span></span></code></pre></div>
<p>문제가 생겨 <code>HLS</code>가 올라오지 않을 때는 제일 먼저, <code>Neovim</code>에 연동되어 돌아가기 전에, standalone으로 정상 작동하는지 보는게 편합니다.</p>
<p><code>HLS</code>가 정상적으로 올라왔는데 동작이 이상할 때 <code>CocConfig</code>를 열어 <code>args</code>에 다음을 추가하여, <code>HLS</code>의 로그를 볼 수 있습니다.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="er">...</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="er">&quot;languageserver&quot;:</span> <span class="fu">{</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;haskell&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;command&quot;</span><span class="fu">:</span> <span class="st">&quot;haskell-language-server-wrapper&quot;</span><span class="fu">,</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;args&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="st">&quot;--lsp&quot;</span><span class="ot">,</span><span class="st">&quot;-d&quot;</span><span class="ot">,</span><span class="st">&quot;-l&quot;</span><span class="ot">,</span><span class="st">&quot;hls.log&quot;</span><span class="ot">]</span><span class="fu">,</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="er">...</span></span></code></pre></div>
<p>※ <code>"args": ["--lsp","-d","--logfile=hls.log"]</code>라 둬서 정상 작동하지 않는 걸 Ailrun님 조언으로 해결했습니다.
설정을 바꿨으니 <code>Coc</code>와 <code>HLS</code>를 재시작합니다.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>:CocRestart</span></code></pre></div>
<h3 id="설정-목록">설정 목록</h3>
<p>쉘에서 아래 명령어로 가능한 설정을 확인 할 수 있습니다.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> haskell-language-server-wrapper <span class="ex">generate-default-config</span></span></code></pre></div>
<p>2022.10 버전 1.8.0.0에서는 아래와 같이 나옵니다.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;haskell&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;checkParents&quot;</span><span class="fu">:</span> <span class="st">&quot;CheckOnSave&quot;</span><span class="fu">,:</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;checkProject&quot;</span><span class="er">:</span> <span class="kw">true</span><span class="fu">,</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;formattingProvider&quot;</span><span class="fu">:</span> <span class="st">&quot;ormolu&quot;</span><span class="fu">,</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;maxCompletions&quot;</span><span class="fu">:</span> <span class="dv">40</span><span class="fu">,</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;plugin&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;alternateNumberFormat&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>                <span class="dt">&quot;globalOn&quot;</span><span class="fu">:</span> <span class="kw">true</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>            <span class="fu">},</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;callHierarchy&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>                <span class="dt">&quot;globalOn&quot;</span><span class="fu">:</span> <span class="kw">true</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>            <span class="fu">},</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;changeTypeSignature&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>                <span class="dt">&quot;globalOn&quot;</span><span class="fu">:</span> <span class="kw">true</span></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>            <span class="fu">},</span></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;class&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>                <span class="dt">&quot;codeActionsOn&quot;</span><span class="fu">:</span> <span class="kw">true</span><span class="fu">,</span></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>                <span class="dt">&quot;codeLensOn&quot;</span><span class="fu">:</span> <span class="kw">true</span></span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>            <span class="fu">},</span></span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;eval&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>                <span class="dt">&quot;config&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">&quot;diff&quot;</span><span class="fu">:</span> <span class="kw">true</span><span class="fu">,</span></span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">&quot;exception&quot;</span><span class="fu">:</span> <span class="kw">false</span></span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>                <span class="fu">},</span></span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a>                <span class="dt">&quot;globalOn&quot;</span><span class="fu">:</span> <span class="kw">true</span></span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a>            <span class="fu">},</span></span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;explicit-fixity&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a>                <span class="dt">&quot;globalOn&quot;</span><span class="fu">:</span> <span class="kw">true</span></span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a>            <span class="fu">},</span></span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;fourmolu&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb24-32"><a href="#cb24-32" aria-hidden="true" tabindex="-1"></a>                <span class="dt">&quot;config&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb24-33"><a href="#cb24-33" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">&quot;external&quot;</span><span class="fu">:</span> <span class="kw">false</span></span>
<span id="cb24-34"><a href="#cb24-34" aria-hidden="true" tabindex="-1"></a>                <span class="fu">}</span></span>
<span id="cb24-35"><a href="#cb24-35" aria-hidden="true" tabindex="-1"></a>            <span class="fu">},</span></span>
<span id="cb24-36"><a href="#cb24-36" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;gadt&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb24-37"><a href="#cb24-37" aria-hidden="true" tabindex="-1"></a>                <span class="dt">&quot;globalOn&quot;</span><span class="fu">:</span> <span class="kw">true</span></span>
<span id="cb24-38"><a href="#cb24-38" aria-hidden="true" tabindex="-1"></a>            <span class="fu">},</span></span>
<span id="cb24-39"><a href="#cb24-39" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;ghcide-code-actions-bindings&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb24-40"><a href="#cb24-40" aria-hidden="true" tabindex="-1"></a>                <span class="dt">&quot;globalOn&quot;</span><span class="fu">:</span> <span class="kw">true</span></span>
<span id="cb24-41"><a href="#cb24-41" aria-hidden="true" tabindex="-1"></a>            <span class="fu">},</span></span>
<span id="cb24-42"><a href="#cb24-42" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;ghcide-code-actions-fill-holes&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb24-43"><a href="#cb24-43" aria-hidden="true" tabindex="-1"></a>                <span class="dt">&quot;globalOn&quot;</span><span class="fu">:</span> <span class="kw">true</span></span>
<span id="cb24-44"><a href="#cb24-44" aria-hidden="true" tabindex="-1"></a>            <span class="fu">},</span></span>
<span id="cb24-45"><a href="#cb24-45" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;ghcide-code-actions-imports-exports&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb24-46"><a href="#cb24-46" aria-hidden="true" tabindex="-1"></a>                <span class="dt">&quot;globalOn&quot;</span><span class="fu">:</span> <span class="kw">true</span></span>
<span id="cb24-47"><a href="#cb24-47" aria-hidden="true" tabindex="-1"></a>            <span class="fu">},</span></span>
<span id="cb24-48"><a href="#cb24-48" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;ghcide-code-actions-type-signatures&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb24-49"><a href="#cb24-49" aria-hidden="true" tabindex="-1"></a>                <span class="dt">&quot;globalOn&quot;</span><span class="fu">:</span> <span class="kw">true</span></span>
<span id="cb24-50"><a href="#cb24-50" aria-hidden="true" tabindex="-1"></a>            <span class="fu">},</span></span>
<span id="cb24-51"><a href="#cb24-51" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;ghcide-completions&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb24-52"><a href="#cb24-52" aria-hidden="true" tabindex="-1"></a>                <span class="dt">&quot;config&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb24-53"><a href="#cb24-53" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">&quot;autoExtendOn&quot;</span><span class="fu">:</span> <span class="kw">true</span><span class="fu">,</span></span>
<span id="cb24-54"><a href="#cb24-54" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">&quot;snippetsOn&quot;</span><span class="fu">:</span> <span class="kw">true</span></span>
<span id="cb24-55"><a href="#cb24-55" aria-hidden="true" tabindex="-1"></a>                <span class="fu">},</span></span>
<span id="cb24-56"><a href="#cb24-56" aria-hidden="true" tabindex="-1"></a>                <span class="dt">&quot;globalOn&quot;</span><span class="fu">:</span> <span class="kw">true</span></span>
<span id="cb24-57"><a href="#cb24-57" aria-hidden="true" tabindex="-1"></a>            <span class="fu">},</span></span>
<span id="cb24-58"><a href="#cb24-58" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;ghcide-hover-and-symbols&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb24-59"><a href="#cb24-59" aria-hidden="true" tabindex="-1"></a>                <span class="dt">&quot;hoverOn&quot;</span><span class="fu">:</span> <span class="kw">true</span><span class="fu">,</span></span>
<span id="cb24-60"><a href="#cb24-60" aria-hidden="true" tabindex="-1"></a>                <span class="dt">&quot;symbolsOn&quot;</span><span class="fu">:</span> <span class="kw">true</span></span>
<span id="cb24-61"><a href="#cb24-61" aria-hidden="true" tabindex="-1"></a>            <span class="fu">},</span></span>
<span id="cb24-62"><a href="#cb24-62" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;ghcide-type-lenses&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb24-63"><a href="#cb24-63" aria-hidden="true" tabindex="-1"></a>                <span class="dt">&quot;config&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb24-64"><a href="#cb24-64" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">&quot;mode&quot;</span><span class="fu">:</span> <span class="st">&quot;always&quot;</span></span>
<span id="cb24-65"><a href="#cb24-65" aria-hidden="true" tabindex="-1"></a>                <span class="fu">},</span></span>
<span id="cb24-66"><a href="#cb24-66" aria-hidden="true" tabindex="-1"></a>                <span class="dt">&quot;globalOn&quot;</span><span class="fu">:</span> <span class="kw">true</span></span>
<span id="cb24-67"><a href="#cb24-67" aria-hidden="true" tabindex="-1"></a>            <span class="fu">},</span></span>
<span id="cb24-68"><a href="#cb24-68" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;hlint&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb24-69"><a href="#cb24-69" aria-hidden="true" tabindex="-1"></a>                <span class="dt">&quot;codeActionsOn&quot;</span><span class="fu">:</span> <span class="kw">true</span><span class="fu">,</span></span>
<span id="cb24-70"><a href="#cb24-70" aria-hidden="true" tabindex="-1"></a>                <span class="dt">&quot;config&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb24-71"><a href="#cb24-71" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">&quot;flags&quot;</span><span class="fu">:</span> <span class="ot">[]</span></span>
<span id="cb24-72"><a href="#cb24-72" aria-hidden="true" tabindex="-1"></a>                <span class="fu">},</span></span>
<span id="cb24-73"><a href="#cb24-73" aria-hidden="true" tabindex="-1"></a>                <span class="dt">&quot;diagnosticsOn&quot;</span><span class="fu">:</span> <span class="kw">true</span></span>
<span id="cb24-74"><a href="#cb24-74" aria-hidden="true" tabindex="-1"></a>            <span class="fu">},</span></span>
<span id="cb24-75"><a href="#cb24-75" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;importLens&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb24-76"><a href="#cb24-76" aria-hidden="true" tabindex="-1"></a>                <span class="dt">&quot;codeActionsOn&quot;</span><span class="fu">:</span> <span class="kw">true</span><span class="fu">,</span></span>
<span id="cb24-77"><a href="#cb24-77" aria-hidden="true" tabindex="-1"></a>                <span class="dt">&quot;codeLensOn&quot;</span><span class="fu">:</span> <span class="kw">true</span></span>
<span id="cb24-78"><a href="#cb24-78" aria-hidden="true" tabindex="-1"></a>            <span class="fu">},</span></span>
<span id="cb24-79"><a href="#cb24-79" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;moduleName&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb24-80"><a href="#cb24-80" aria-hidden="true" tabindex="-1"></a>                <span class="dt">&quot;globalOn&quot;</span><span class="fu">:</span> <span class="kw">true</span></span>
<span id="cb24-81"><a href="#cb24-81" aria-hidden="true" tabindex="-1"></a>            <span class="fu">},</span></span>
<span id="cb24-82"><a href="#cb24-82" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;pragmas&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb24-83"><a href="#cb24-83" aria-hidden="true" tabindex="-1"></a>                <span class="dt">&quot;codeActionsOn&quot;</span><span class="fu">:</span> <span class="kw">true</span><span class="fu">,</span></span>
<span id="cb24-84"><a href="#cb24-84" aria-hidden="true" tabindex="-1"></a>                <span class="dt">&quot;completionOn&quot;</span><span class="fu">:</span> <span class="kw">true</span></span>
<span id="cb24-85"><a href="#cb24-85" aria-hidden="true" tabindex="-1"></a>            <span class="fu">},</span></span>
<span id="cb24-86"><a href="#cb24-86" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;qualifyImportedNames&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb24-87"><a href="#cb24-87" aria-hidden="true" tabindex="-1"></a>                <span class="dt">&quot;globalOn&quot;</span><span class="fu">:</span> <span class="kw">true</span></span>
<span id="cb24-88"><a href="#cb24-88" aria-hidden="true" tabindex="-1"></a>            <span class="fu">},</span></span>
<span id="cb24-89"><a href="#cb24-89" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;refineImports&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb24-90"><a href="#cb24-90" aria-hidden="true" tabindex="-1"></a>                <span class="dt">&quot;codeActionsOn&quot;</span><span class="fu">:</span> <span class="kw">true</span><span class="fu">,</span></span>
<span id="cb24-91"><a href="#cb24-91" aria-hidden="true" tabindex="-1"></a>                <span class="dt">&quot;codeLensOn&quot;</span><span class="fu">:</span> <span class="kw">true</span></span>
<span id="cb24-92"><a href="#cb24-92" aria-hidden="true" tabindex="-1"></a>            <span class="fu">},</span></span>
<span id="cb24-93"><a href="#cb24-93" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;rename&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb24-94"><a href="#cb24-94" aria-hidden="true" tabindex="-1"></a>                <span class="dt">&quot;config&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb24-95"><a href="#cb24-95" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">&quot;crossModule&quot;</span><span class="fu">:</span> <span class="kw">false</span></span>
<span id="cb24-96"><a href="#cb24-96" aria-hidden="true" tabindex="-1"></a>                <span class="fu">},</span></span>
<span id="cb24-97"><a href="#cb24-97" aria-hidden="true" tabindex="-1"></a>                <span class="dt">&quot;globalOn&quot;</span><span class="fu">:</span> <span class="kw">true</span></span>
<span id="cb24-98"><a href="#cb24-98" aria-hidden="true" tabindex="-1"></a>            <span class="fu">},</span></span>
<span id="cb24-99"><a href="#cb24-99" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;retrie&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb24-100"><a href="#cb24-100" aria-hidden="true" tabindex="-1"></a>                <span class="dt">&quot;globalOn&quot;</span><span class="fu">:</span> <span class="kw">true</span></span>
<span id="cb24-101"><a href="#cb24-101" aria-hidden="true" tabindex="-1"></a>            <span class="fu">}</span></span>
<span id="cb24-102"><a href="#cb24-102" aria-hidden="true" tabindex="-1"></a>        <span class="fu">}</span></span>
<span id="cb24-103"><a href="#cb24-103" aria-hidden="true" tabindex="-1"></a>    <span class="fu">}</span></span>
<span id="cb24-104"><a href="#cb24-104" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<h3 id="abi-충돌">ABI 충돌</h3>
<p>wrapper를 돌렸을 때, ABI 충돌이 나며 끝에 아래와 같은 메시지가 나올 때가 있습니다.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>{&quot;jsonrpc&quot;:&quot;2.0&quot;, &quot;method&quot;:&quot;window/showMessage&quot;, &quot;params&quot;: {&quot;type&quot;: 1, &quot;message&quot;: &quot;Couldn't find a working/matching GHC installation. Consider installing ghc-9.2.4 via ghcup or build HLS from source.&quot;}}</span></code></pre></div>
<p>ABI 충돌은 결국, 현재 쓰고 있는 GHC와, HLS를 컴파일한 GHC가 맞지 않아 생기는 오류입니다. ghcup로 싹다 지우고, cache도 지우고, 다시 깨끗한 환경에서 설치했는데도 아래와 같은 오류가 났습니다.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>$ haskell-language-server-9.2.4</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>No compiler found, expected minor version match with ghc-9.2.4 (x86_64-tinfo6) (based on resolver setting in /home/jacoo/.stack/global-project/stack.yaml).</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>To install the correct GHC into /home/jacoo/.stack/programs/x86_64-linux/, try running &quot;stack setup&quot; or use the &quot;--install-ghc&quot; flag. To use your system GHC installation, run &quot;stack config set system-ghc --global true&quot;, or use the &quot;--system-ghc&quot; flag.</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>All methods exhausted!</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>Content-Length: 203</span></code></pre></div>
<p>위와 같이 ABI 충돌을 해결하지 못할 때, HLS를 현재 시스템이 쓰는 GHC로 컴파일해서 해결을 시도할 수 있습니다.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="ex">ghcup</span> compile hls <span class="at">--version</span> 1.8.0.0 <span class="at">--ghc</span> 9.2.4</span></code></pre></div>
<p>저는 위 방법으로, 컴파일을 시도했는데, 제 데비안 환경과 맞지 않는 무엇이 있는지 계속 컴파일 에러가 났습니다.<br />
Haskell Language Server 관리자이신 Airun님의 조언으로 아래와 같이 git repository에서 바로 소스를 가져오게 바꿔 해결했습니다. 컴파일이 안됐던 이유는,<br />
release 기준으로 빌드하면 Hackage에서 가져와서 빌드하는데, Hackage에는 version bound가 이상하게 올라갈 때가 있다고 합니다. (무언가 수작업으로 해야 하는 작업이 있어, 사람 손을 타다 보니 생기는 경우라 합니다.) (Ailrun님 감사합니다.)</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="ex">ghcup</span> compile hls <span class="at">--git-ref</span> master <span class="at">--ghc</span> 9.2.4</span></code></pre></div>
<p>컴파일을 마치고 나면, 지원되지 않는 플러그인이 있는지 확인해야 합니다. GHC버전이 올라감에 따라 바로 적용되지 않는 플러그인들이 생깁니다. 아래 명령어로 현재 컴파일된 hls가 지원하는 플러그인 목록을 볼 수 있습니다.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>&gt; haskell-language-server-wrapper --list-plugin</span></code></pre></div>
<p><a href="https://haskell-language-server.readthedocs.io/en/latest/support/plugin-support.html#current-plugin-support-tiers">HLS latest 버전 매뉴얼</a></p>
<h3 id="stack-버그">Stack 버그</h3>
<p>이제 막 셋팅한 분들은 아직 보지 않으셔도 되는 내용입니다. 같은 경우를 만나는 경우는 드물 것 같긴 한데, 혹시라도 HLS가 정상적으로 실행되지 않을 때 힌트를 얻을만한 부분이 있을까 해서 올려 놓습니다.</p>
<p><code>stack new myApp</code>으로 새 프로젝트 폴더를 만들고, 아래와 같이 수정합니다.
<code>package.yaml</code> 파일에 아래와 같이 <code>dependencies</code>에서 <code>myApp</code> 라이브러리를 빼고</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span><span class="kw">:</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">source-dirs</span><span class="kw">:</span><span class="at"> src</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="fu">executables</span><span class="kw">:</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">myApp-exe</span><span class="kw">:</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">main</span><span class="kw">:</span><span class="at">                Main.hs</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">source-dirs</span><span class="kw">:</span><span class="at">         app</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ghc-options</span><span class="kw">:</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> -threaded</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> -rtsopts</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> -with-rtsopts=-N</span></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">dependencies</span><span class="kw">:</span><span class="at"> </span><span class="kw">[]</span></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a><span class="co">      #- myApp</span></span></code></pre></div>
<p><code>Main.hs</code> 소스에서도 <code>import Lib</code>를 빼면</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="kw">module</span> <span class="dt">Main</span> <span class="kw">where</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="co">--import Lib</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="ot">main ::</span> <span class="dt">IO</span> ()</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>main <span class="ot">=</span> someFunc</span></code></pre></div>
<p>아래와 같은 에러가 나며, HLS가 시작되지 않습니다.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>  ghcide compiled by GHC 9.0 failed to load packages: &lt;command line&gt;: cannot satisfy -package</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  myApp-0.1.0.0</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  (use -v for more information).</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  Please ensure that ghcide is compiled with the same GHC installation as the project.</span></code></pre></div>
<p>뜬금 없이 <code>HLS</code>에 포함되어 있는 <code>ghcide</code>가 프로젝트와 같은 <code>GHC</code> 버전으로 컴파일 되지 않았다는 에러입니다. 그런데, 그 위에 메시지를 보면 패키지 로드에 실패했다는 메시지도 보입니다. 이 상태에서 <code>stack build</code>를 하고 나면 <code>HLS</code>가 정상 동작합니다.</p>
<p><code>hie-bios</code><a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>는 <code>stack repl</code>을 쓰는데, <code>stack repl</code>은 <code>executables</code>에 있는 파일을 볼 때 <code>dependencies</code>에 있는 <em>로컬 라이브러리 컴포넌트는 빌드하지 않는다</em>고 합니다. <code>stack build</code>는 <code>library</code>와 <code>executables</code>를 모두 빌드하는데, <code>stack repl</code>은 다른 동작을 합니다. <code>stack</code>의 버그로 볼 수 있다고 합니다. (Ailrun님, 조언 감사합니다.) 이런 이유로 <code>Cabal</code>이 아닌 <code>stack</code>을 쓸 때는 <code>stack build</code>를 한 번 해줘야 <code>HLS</code>가 정상 동작합니다.</p>
<p><code>HLS</code>가 시작 못하는 진짜 이유는, <code>package.yaml</code>에 의존성이 지정되어 있는 패키지(여기 경우는 myApp)를 로드하려 하는데, 해당 패키지가 없기 때문입니다. 이 때, <code>stack build</code>를 하면 라이브러리가 쓰이든 안 쓰이든 모두 빌드됩니다.</p>
<p>만일 <code>Main.hs</code>를 아래와 같이 <code>import Lib</code>를 넣어 주면, <code>stack build</code>를 하지 않아도 <code>HLS</code>가 작동합니다.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="kw">module</span> <span class="dt">Main</span> <span class="kw">where</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="dt">Lib</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="ot">main ::</span> <span class="dt">IO</span> ()</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>main <span class="ot">=</span> someFunc</span></code></pre></div>
<p>장황하긴 한데, HLS가 동작하려면 필요한 조건과, <code>stack</code>이 일괄적인 동작을 하지 않는 부분은 알아두면 도움이 되는 곳이 있을 것 같습니다.</p>
<h2 id="tip">Tip</h2>
<h3 id="ghci에서-vim-키바인딩-쓰기">GHCi에서 vim 키바인딩 쓰기</h3>
<p>Vim 안에서 터미널을 열어 GHCi를 쓰다 보면, Vim 키로 편집하려 들 때가 있습니다. Vim을 쓴다고 꼭 설정해야 효율적이진 않지만, 기호에 따라 쓸만한 팁입니다.</p>
<p><code>~/.haskeline</code> 파일에</p>
<pre class="vim"><code>editMode: Vi</code></pre>
<p>를 넣어주면 <code>ctrl [</code>도 작동하고 <code>h</code>,<code>j</code>,<code>k</code>,<code>l</code>,<code>0</code>,<code>a</code>,<code>w</code>,<code>b</code>등이 작동합니다.</p>
<h3 id="bash에서-vim-키바인딩-쓰기">BASH에서 vim 키바인딩 쓰기</h3>
<p><code>~/.bashrc</code>에 아래를 추가합니다.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="bu">set</span> <span class="at">-o</span> vi</span></code></pre></div>
<p>바뀐 설정을 적용하기 위해</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> source <span class="ex">~/.bashrc</span></span></code></pre></div>
<p>이제 쉘 커맨드 환경에서도 vim 바인딩이 먹습니다.</p>
<h3 id="키-반복이-아닌-명령어-반복">키 반복이 아닌, 명령어 반복</h3>
<p><code>@:</code></p>
<h3 id="클립보드-내용을-vim-명령행에-붙여-넣기">클립보드 내용을 vim 명령행에 붙여 넣기</h3>
<p><code>Ctrl r</code> , <code>+</code></p>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr />
<ol>
<li id="fn1"><p><strong>hie-bios</strong>
<code>HLS</code>가 하스켈 프로젝트를 어떻게 빌드할지 알아야 합니다. 어떤 플래그, 패키지등이 필요한지 정보가 필요합니다. <code>hie-bios</code>는 현재 사용중인 빌드 시스템으로부터 이런 정보들을 가져오는 툴입니다.
<a href="https://github.com/haskell/hie-bios/blob/master/README.md" class="uri">https://github.com/haskell/hie-bios/blob/master/README.md</a><a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

<div class="comment">
  <script>
    document.addEventListener('DOMContentLoaded', loadUtterances, { once: true });
  </script>
</div>
<div style="text-align:right">Github 계정이 없는 분은 메일로 보내주세요. lionhairdino at gmail.com </div>

  </div>
  <nav class="toc toc-right js-toc relative z-1 transition--300 absolute pa4 pt5 is-position-fixed"></nav>
  <div id="footer">
    © 2022 lionhairdino. All rights reserved. Generated by <a href="http://jaspervdj.be/hakyll">Hakyll</a>
  </div>
  <script>
    tocbot.init({
      tocSelector: '.js-toc',
      contentSelector: '.js-toc-content',
      headingSelector: 'h2, h3',
      hasInnerContainers: true,
    });
  </script>
</body>

</html>
