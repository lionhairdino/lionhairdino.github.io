<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ko" lang="ko">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />

        <title>lionhairdino - Vim + Haskell Language Server</title>

        <meta name="description" content="lionhairdino - Vim + Haskell Language Server" />
        <meta property="og:description" content="하스켈 함수형 프로그래밍" />

        <link rel="stylesheet" type="text/css" href="../css/default.css" />
        <link rel="icon" href="https://lionhairdino.github.io/favicon.svg" />
        <link rel="icon" type="image/png" href="../images/favicon/Lionhairdino16px.png" sizes="16x16" />
        <link rel="icon" type="image/png" href="../images/favicon/Lionhairdino24px.png" sizes="24x24" />
        <link rel="icon" type="image/png" href="../images/favicon/Lionhairdino32px.png" sizes="32x32" />
        <link rel="icon" type="image/png" href="../images/favicon/Lionhairdino48px.png" sizes="48x48" />
        <link rel="icon" type="image/png" href="../images/favicon/Lionhairdino57px.png" sizes="57x57" />
        <link rel="icon" type="image/png" href="../images/favicon/Lionhairdino60px.png" sizes="60x60" />
        <link rel="icon" type="image/png" href="../images/favicon/Lionhairdino64px.png" sizes="64x64" />
        <link rel="icon" type="image/png" href="../images/favicon/Lionhairdino72px.png" sizes="72x72" />
        <link rel="icon" type="image/png" href="../images/favicon/Lionhairdino76px.png" sizes="76x76" />
        <link rel="icon" type="image/png" href="../images/favicon/Lionhairdino114px.png" sizes="114x114" />
        <link rel="apple-touch-icon-precomposed" href="../images/favicon/Lionhairdino120px.png" sizes="120x120" />
        <link rel="apple-touch-icon-precomposed" href="../images/favicon/Lionhairdino144px.png" sizes="144x144" />
        <link rel="shortcut icon" href="../favicon.ico" />
        <link rel="apple-touch-icon-precomposed" href="../images/favicon/Lionhairdino152px.png" sizes="152x152" />
        <link rel="apple-touch-icon-precomposed" href="../images/favicon/Lionhairdino180px.png" sizes="180x180" />
        <link rel="icon" type="image/png" href="../images/favicon/Lionhairdino192px.png" sizes="192x192" />
        <link rel="manifest" href="../site.webmanifest" />
        <link rel="mask-icon" href="https://lionhairdino.github.io/Lionhairdino_black.svg" color="#ff7500" />
        <meta name="msapplication-TileImage" content="/images/favicon/Lionhairdino144px.png" />
        <meta name="msapplication-TileColor" content="#ff7500" />
        <meta name="theme-color" content="#ffffff" />
        <meta property="og:type" content="website" />
        <meta property="og:title" content="Vim + Haskell Language Server" />
        <meta property="og:site_name" content="Lionhairdino" />
        <meta property="og:url" content="https://lionhairdino.github.io/posts/2022-07-02-vim.html" />

        <meta property="og:image" content="https://lionhairdino.github.io/images/vim_hls.png" />

      <meta name="keywords" content="Vim, HLS, Neovim, LSP, Language Server Protocol, Coc">
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-E9WZ6VXGHP"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-E9WZ6VXGHP');
</script>
<script src="../script/copycode.js"></script>
<script async src="https://cse.google.com/cse.js?cx=9c53b4915cbb2605c"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.11.1/tocbot.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.11.1/tocbot.css" />
    </head>
    <body>
        <div id="header">
            <div style="display:inline-block;margin-right:5px;padding-top: 5px;" id="logo">
                <a href="../"><img style="width:30px;border:none" src="../images/favicon/Lionhairdino48px.png"></a>
            </div>
            <div style="display:inline-block;vertical-align: top;padding-top:5px;" id="navigation">
                <a href="../">lionhairdino</a>
                <a href="../about.html">about</a>
                <!--<a href="/archive.html">archive</a>-->
            </div>
            <div style="display:inline-block;font-size:0.8em;vertical-align: top;">
                <div style="display:inline-block;vertical-align: top;padding-top: 5px">사이트내 검색</div>
                <div style="display:inline-block;width:180px;"> 
                    <div class="gcse-searchbox-only"></div>
                </div>
            </div>
            <div>
                여기 글들은 일종의 질문입니다. 주의! 틀린 내용이 있을 수 있습니다. 용어 선택도 학계, 업계에서 쓰는 걸로 되어 있지 않습니다.
            </div>
        </div>
        <div class="js-toc-content">
            <h1>Vim + Haskell Language Server</h1>
            <link rel="stylesheet" type="text/css" href="../css/syntax.css" />
<div class="info">
    Posted on July  2, 2022
    
</div>

<p>저는 nn년 전부터 시스템 관리를 위해 <code>Vim</code>을 써오고 있고 한동안 순정 <code>Vim</code>으로 아무 생각없이 써왔습니다. 그리고 하스켈을 공부하면서 부터는 <code>vscode</code>를 주로 썼습니다. 간단한 편집 기능키들은 손에 익은 <code>Vim</code>모드로 해놓고 별 불만없이 썼습니다. 전 완전 키보드파는 아니라, 마우스가 전혀 작동하지 않는 환경은 오히려 좀 답답해서, <code>Vim</code>을 하스켈의 메인 편집 툴로 쓸 생각은 안하고 있던 차에, 우연히 다른 분의 <code>Vim</code> 문제를 도우려 살펴 보다 보니, nn년 전에 비하면 설정이 굉장히 쉬워진 것 같아, <code>Vim</code>에 제대로 <code>Haskell</code> 셋팅을 시도하게 됐습니다. 아래는 현재2022 제가 쓰고 있는 설정들인데, 계속 발전하고 있으니 최신 정보들을 확인해 보세요.</p>
<h2 id="neovim">Neovim</h2>
<p><code>vi</code>를 쓴다 하면 대부분 <code>vi</code>에서 확장된 <code>vim</code>을 의미하지 않나요? 그리고 <code>vim</code>을 그래픽컬하게 쓰기 위해 <code>GUI</code>를 입힌 <code>gvim</code>, <code>spacevim</code>, <code>oni</code>등 있는데, 저는 터미널에서 가장 빠르게 부트업 되는 <code>vi</code>를 버릴 수가 없어 <code>neovim</code>을 선택했습니다. <code>vim</code>과의 차이점은 여러 가지가 있는데, 제가 체감하는 정도는 <code>Lua</code> 스크립트 내장으로 퍼포먼스가 올라간 게 가장 큰 차이점이 아닐까 합니다. 시스템 설정 파일들을 주로 만지는 분들은 <code>vim</code>과 <code>neovim</code>이 큰 차이가 있어 보이지 않을 수 있는데, 프로그래머가 메인 툴로 쓰려면 이제는 <code>neovim</code>으로 넘어가는 게 편할 것 같습니다. (케케묵은 <code>vi</code>와 <code>emacs</code> 논쟁을 얘기 하고 싶은게 아니라, 이미 <code>vi (vim)</code>을 쓰시는 분들 얘기입니다.)</p>
<p>참고 : <a href="https://alpha2phi.medium.com/learn-neovim-the-practical-way-8818fcf4830f#545a">Learn Neovim The Practical Way</a></p>
<h4 id="vimscript를-대체-하는-임베드-스크립트-lua">VimScript를 대체 하는 임베드 스크립트 Lua</h4>
<p><a href="https://github.com/henriquehbr/lua-vs-vimscript">벤치마크</a> 결과만 보면 압도적이긴 한데, 항상 그럴지는 써봐야 압니다.</p>
<h4 id="마우스-설정">마우스 설정</h4>
<p>전 완벽하게 키보드만 쓰는 스타일은 아니고, 창pane 크기 조절, 텍스트 선택 등은 마우스가 편합니다. 아마도 최소한의 마우스 기능이 지원되지 않았으면 <code>vscode</code>를 썼을지도 모르겠습니다. 추가로 다른 앱과 복사, 붙이기를 위해 시스템 클립 보드를 사용하도록 설정합니다.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="at">set mouse=a &quot; 마우스로 창 크기 조절, 탭 선택 등..</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="at">set clipboard+=unnamedplus &quot; 시스템 클립보드 쓰기</span></span></code></pre></div>
<h3 id="plugin---nerdtree">Plugin - NerdTree</h3>
<p>예전엔 <a href="https://github.com/preservim/nerdtree"><code>NerdTree</code></a> 외에는 대안이 없었던 것 같은데 요즘은 <a href="https://github.com/nvim-neo-tree/neo-tree.nvim"><code>NeoTree</code></a>를 선택하는 프리셋들이 종 종 보입니다. <code>Lua</code>로 개발되어 좀 더 퍼포먼스가 좋고, 폰트와 이미지 활용이 더 깔끔합니다만, 아직 폴더 즐겨 찾기가 지원 되지 않아, 아직은 <code>NerdTree</code>를 쓰고 있습니다.</p>
<h3 id="plugin---workspace">Plugin - Workspace</h3>
<p><a href="https://github.com/natecraddock/workspaces.nvim" class="uri">https://github.com/natecraddock/workspaces.nvim</a>
여러 pane으로 나눠놓고 작업하다 <code>:qa</code>로 종료하고 나서, 다시 열면 원래 작업하던 상태로 돌아가기 위해 사용합니다.</p>
<h3 id="plugin---neoterm">Plugin - Neoterm</h3>
<p><a href="https://github.com/kassio/neoterm" class="uri">https://github.com/kassio/neoterm</a>
입력 모드로 들어가서 터미널을 사용하는 것 까진 매뉴얼 없이 자연스럽게 되는데, 터미널을 벗어나는 키는 봐 둘 필요가 있습니다. <code>&lt;leader&gt; n</code> 보통 <code>leader</code>키는 <code>\</code>로 설정되어 있습니다.</p>
<h3 id="plugin---nvim-web-devicons">Plugin - Nvim Web Devicons</h3>
<p><a href="https://github.com/kyazdani42/nvim-web-devicons" class="uri">https://github.com/kyazdani42/nvim-web-devicons</a>
텍스트 환경에서 UI를 구현하니, 폰트들의 모양을 이 것 저 것 활용하는데, 이러기 위해서 적당한 <code>Font</code>를 설치해야 합니다.</p>
<h2 id="language-server-protocol-client">Language Server Protocol Client</h2>
<figure>
<img src="../images/vim_hls.png" alt="Neovim + HLS" /><figcaption aria-hidden="true">Neovim + HLS</figcaption>
</figure>
<p>가장 흔한 설정이 아래 4가지로 보입니다.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">1.</span>    Vim <span class="at">-</span><span class="op">&gt;</span> 플러그인 Coc                   <span class="at">------</span> LSP <span class="at">-----</span><span class="op">&gt;</span> HLS</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="ex">2.</span> Neovim <span class="at">-</span><span class="op">&gt;</span> 빌트인 LSP 클라이언트          <span class="at">------</span> LSP <span class="at">-----</span><span class="op">&gt;</span> HLS</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="ex">3.</span> Neovim <span class="at">-</span><span class="op">&gt;</span> 플러그인 LanguageClient-neovim <span class="at">------</span> LSP <span class="at">-----</span><span class="op">&gt;</span> HLS</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="ex">4.</span> Neovim <span class="at">-</span><span class="op">&gt;</span> 플러그인 Coc                   <span class="at">------</span> LSP <span class="at">-----</span><span class="op">&gt;</span> HLS</span></code></pre></div>
<p><code>Neovim</code>을 <code>LSP</code>서버와 붙이려면 많이 쓰는 방식은 빌트인 되어 있는 <code>Native LSP Client</code>, <code>Vim</code>과 호환되는 <code>Coc</code> 또는 <code>LanguageClient</code> 플러그인을 씁니다. 저는 이 중 <code>Coc</code>를 선택했습니다. <code>Vim + LSP</code> 관련 내용을 서핑으로 찾아 볼 때, 어떤 플러그인 글인가 자세히 보셔야 합니다.</p>
<h3 id="coc">Coc</h3>
<p><a href="https://github.com/neoclide/coc.nvim" class="uri">https://github.com/neoclide/coc.nvim</a>
이 전에는 꽤 여러개의 플러그인을 동원해서 IDE스러운 설정들을 했었던 것 같은데, 지금은 <code>LSP</code> 클라이언트와 각 언어에 맞는 Language Server를 띄워서 붙이면 어지간한 IDE 동작들은 다 하는 것 같습니다.</p>
<h4 id="neovim-플러그인-설치-방법">neovim 플러그인 설치 방법</h4>
<p><code>neovim</code>을 실행할 때 읽어들이는 파일에 한 줄 추가하는 것으로 플러그인 설치가 끝납니다. 예전에 다운로드 받아서 설치하던 때에 비교하면 정말 많이 편해진 것 같습니다.
제 경우는 neovim 설정 파일이 아래 위치에 있고, <code>[vim-plug](https://github.com/junegunn/vim-plug)</code>를 플러그인 관리툴로 쓰고 있습니다.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="ex">~/.config/nvim/init.vim</span></span></code></pre></div>
<p>여기다 <code>neoclide/coc.nvim</code>, <code>scrooloose/nerdtree</code>, <code>thaerkh/vim-workspace</code>, <code>kassio/neoterm</code> 등을 추가합니다.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="at">call plug</span><span class="co">#begin()</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">Plug 'scrooloose/nerdtree', { 'on'</span><span class="kw">:</span><span class="at"> </span><span class="st">'NERDTreeToggle'</span><span class="at"> </span><span class="er">}</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="at">Plug 'Xuyuanp/nerdtree-git-plugin'</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="at">Plug 'thaerkh/vim-workspace'</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="at">Plug 'kassio/neoterm'</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="fu">Plug 'neoclide/coc.nvim', {'branch'</span><span class="kw">:</span><span class="at"> </span><span class="st">'release'</span><span class="er">}</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="at">Plug 'godlygeek/tabular'</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="at">Plug 'preservim/vim-markdown'</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="fu">Plug 'EdenEast/nightfox.nvim', {'branch'</span><span class="kw">:</span><span class="at"> </span><span class="st">'main'</span><span class="er">}</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="fu">Plug 'iamcco/markdown-preview.nvim', { 'do'</span><span class="kw">:</span><span class="at"> </span><span class="st">'cd app &amp;&amp; yarn install'</span><span class="at"> </span><span class="er">}</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="at">Plug 'MattesGroeger/vim-bookmarks'</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="at">Plug 'kyazdani42/nvim-web-devicons'</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="at">Plug 'itchyny/lightline.vim'</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="at">Plug 'antoinemadec/FixCursorHold.nvim'</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="at">Plug 'kyazdani42/nvim-tree.lua'</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="at">call plug</span><span class="co">#end()</span></span></code></pre></div>
<p>neovim을 재시작하거나 아래 명령어로 설정 파일을 다시 읽어 들입니다.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="at">:source %</span></span></code></pre></div>
<p>그리고 아래 플러그인 설치 명령을 실행하면 휘리릭 설치 완료입니다.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="at">:PlugInstall</span></span></code></pre></div>
<h3 id="haskell-language-server-이하-hls">Haskell Language Server (이하 HLS)</h3>
<p>에디터들이 <code>LSP</code> (Language Server Protocol)에 맞춰 요청을 보내면, 이를 받아 언어 컴파일러나 기타 툴의 도움을 받아 필요한 정보를 돌려주는 툴을 Language Server라 합니다. 하스켈 생태계에서 에디터들의 IDE스런 동작을 도와주는 여러 툴들이 있었는데, 지금은 거의 <a href="https://haskell-language-server.readthedocs.io/en/latest/index.html">Haskell Language Server</a>로 흡수 및 통일 된 것 같습니다.</p>
<p><code>GHC</code>, <code>Stack</code>, <code>Cabal</code>, <code>HLS</code>를 설치할 때, 지금(2022) 가장 권장되는 방식은 <code>ghcup</code>를 이용하는 방식인 듯 합니다.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="ex">ghcup</span> tui</span></code></pre></div>
<p>실행 경로가 잘 잡혀있고 정상 동작하는지 확인하기 위해 아래로 확인</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> haskell-language-server-wrapper</span></code></pre></div>
<h3 id="coc와-hls-연결">Coc와 HLS 연결</h3>
<p>아래 명령어를 입력해서 <code>Coc</code>설정 파일을 엽니다.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="at">:CocConfig</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;coc.preferences.extensionUpdateCheck&quot;</span><span class="fu">:</span> <span class="st">&quot;daily&quot;</span><span class="fu">,</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;languageserver&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;haskell&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;command&quot;</span><span class="fu">:</span> <span class="st">&quot;haskell-language-server-wrapper&quot;</span><span class="fu">,</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;args&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="st">&quot;--lsp&quot;</span><span class="ot">]</span><span class="fu">,</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;rootPatterns&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;stack.yaml&quot;</span><span class="ot">,</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;*.cabal&quot;</span><span class="ot">,</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;cabal.config&quot;</span><span class="ot">,</span>    </span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;package.yaml&quot;</span><span class="ot">,</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;hie.yaml&quot;</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>      <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;filetypes&quot;</span><span class="fu">:</span> <span class="ot">[</span> <span class="st">&quot;hs&quot;</span><span class="ot">,</span> <span class="st">&quot;lhs&quot;</span><span class="ot">,</span> <span class="st">&quot;haskell&quot;</span> <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;initializationOptions&quot;</span><span class="fu">:</span> <span class="fu">{</span> <span class="dt">&quot;languageServerHaskell&quot;</span><span class="fu">:</span> <span class="fu">{}</span> <span class="fu">}</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">}</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">},</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;suggest&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;disableKind&quot;</span><span class="fu">:</span> <span class="kw">true</span><span class="fu">,</span>    </span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;snippetsSupport&quot;</span><span class="fu">:</span> <span class="kw">false</span>    </span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">},</span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;diagnostic&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;virtualText&quot;</span><span class="fu">:</span> <span class="kw">true</span><span class="fu">,</span></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;virtualTextCurrentLineOnly&quot;</span><span class="fu">:</span> <span class="kw">false</span><span class="fu">,</span>    </span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;virtualTextLines&quot;</span><span class="fu">:</span> <span class="dv">1</span><span class="fu">,</span></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;virtualTextPrefix&quot;</span><span class="fu">:</span> <span class="st">&quot; —— &quot;</span></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">},</span></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;list.height&quot;</span><span class="fu">:</span> <span class="dv">20</span><span class="fu">,</span></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;codeLens.enable&quot;</span><span class="fu">:</span> <span class="kw">true</span><span class="fu">,</span></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;coc.preferences.enableMarkdown&quot;</span><span class="fu">:</span> <span class="kw">true</span><span class="fu">,</span></span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;coc.preferences.jumpCommand&quot;</span><span class="fu">:</span> <span class="st">&quot;tab drop&quot;</span>    </span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span> </span></code></pre></div>
<p><code>vim</code>도 설정 파일 위치만 다를 뿐 똑같은 절차로 동작합니다.</p>
<h3 id="사용-방법">사용 방법</h3>
<p>예전엔 <code>tmux</code>로 <code>ghcid</code>를 별도로 띄워놓고 작업하는 경우가 많았는데, 요즘은 많이들 <code>HLS</code>로 넘어가고 있는 것 같습니다. <code>ghcid</code>를 보듯 창을 띄우려면 아래 명령어를 이용합니다.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="at">:CocDiagnostics</span></span></code></pre></div>
<p>아직 이유를 제대로 알지 못하는 오작동 경우가 종종 있는데, 재시작으로 해결해야 하는 경우가 많습니다. 아래 명령어를 입력하거나, 단축키를 지정해 놓고 쓰는 것을 추천드립니다.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="at">:CocRestart</span></span></code></pre></div>
<p><code>init.vim</code>에 단축키 설정</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="at">map &lt;F10&gt; :CocRestart&lt;CR&gt;</span></span></code></pre></div>
<p><code>:Coc</code>까지 입력하고 <code>tab</code>키를 입력하면 지원 명령들을 볼 수 있습니다.</p>
<p>지원하는 명령들을 목록으로 볼 수도 있습니다.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="at">:CocList</span></span></code></pre></div>
<p>아래 명령을 이용하여 <code>LSP</code> 서버에게 여러가지 명령을 전달 할 수 있습니다.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="at">:CocCommand</span></span></code></pre></div>
<h4 id="윙맨wingman">윙맨Wingman</h4>
<p><code>HLS</code>는 다양한 기능들을 플러그인 구조로 구현하고 있습니다. 이 중 타입만 작성하고 hole<code>_</code>을 써 놓으면 코드를 추정해 주는 <a href="https://hackage.haskell.org/package/hls-tactics-plugin">Wingman</a>이란 플러그인이 있는데, 아직은 익숙하지 않은데, 원리를 좀 더 이해한다면 강력한 툴 중 하나가 될지도 모릅니다. 윙맨 플러그인은 <code>HLS</code>를 설치할 때 디폴트로 설치 됩니다.</p>
<h3 id="설정-오류를-고칠-단서-얻는-방법">설정 오류를 고칠 단서 얻는 방법</h3>
<p>이 소스, 저 소스들을 가져와서 실행해 보며 공부하다 보면, 버전 충돌로 인한 에러를 자주 만납니다. 작동을 제대로 하고 있는지 보는 방법 중 가장 간단한 방법은 HLS 프로세스가 떠있나 보는 방법이 있고, 아래 명령어들을 이용해 단서를 얻을 수 있습니다.</p>
<p>꽤 오랫동안 인터넷 문서들을 보며 리눅스 관련 툴들을 설치하곤 했는데, 그 때마다 드는 생각이 “현재 잘 작동하고 있는지, 로그는 어떻게 보는지” 알려주는 문서가 제일 좋았던 것 같습니다.</p>
<p>Neovim 안에서</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="at">:CocCommand workspace.showOutput</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="at">:CocOpenLog</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="at">:messages</span></span></code></pre></div>
<p>프로젝트 루트 폴더에서(stack.yaml이 있는 폴더) 커맨드 라인에서</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> haskell-language-server-wrapper</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> haskell-language-server-9.0.2 <span class="kw">(</span><span class="ex">특정</span> 버전<span class="kw">)</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> stack <span class="ex">build</span> <span class="at">--verbose</span></span></code></pre></div>
<p>문제가 생겨 <code>HLS</code>가 올라오지 않을 때는 제일 먼저, <code>Neovim</code>에 연동되어 돌아가기 전에, standalone으로 정상 작동하는지 보는게 편합니다.</p>
<p><code>HLS</code>가 정상적으로 올라왔는데 동작이 이상할 때 <code>CocConfig</code>를 열어 <code>args</code>에 다음을 추가하여, <code>HLS</code>의 로그를 볼 수 있습니다.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="er">...</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="er">&quot;languageserver&quot;:</span> <span class="fu">{</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;haskell&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;command&quot;</span><span class="fu">:</span> <span class="st">&quot;haskell-language-server-wrapper&quot;</span><span class="fu">,</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;args&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="st">&quot;--lsp&quot;</span><span class="ot">,</span><span class="st">&quot;-d&quot;</span><span class="ot">,</span><span class="st">&quot;-l&quot;</span><span class="ot">,</span><span class="st">&quot;hls.log&quot;</span><span class="ot">]</span><span class="fu">,</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="er">...</span></span></code></pre></div>
<p>※ <code>"args": ["--lsp","-d","--logfile=hls.log"]</code>라 둬서 정상 작동하지 않는 걸 Ailrun님 조언으로 해결했습니다.
설정을 바꿨으니 <code>Coc</code>와 <code>HLS</code>를 재시작합니다.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="at">:CocRestart</span></span></code></pre></div>
<h3 id="stack-버그">Stack 버그</h3>
<p>이제 막 셋팅한 분들은 아직 보지 않으셔도 되는 내용입니다. 같은 경우를 만나는 경우는 드물 것 같긴 한데, 혹시라도 HLS가 정상적으로 실행되지 않을 때 힌트를 얻을만한 부분이 있을까 해서 올려 놓습니다.</p>
<p><code>stack new myApp</code>으로 새 프로젝트 폴더를 만들고, 아래와 같이 수정합니다.
<code>package.yaml</code> 파일에 아래와 같이 <code>dependencies</code>에서 <code>myApp</code> 라이브러리를 빼고</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span><span class="kw">:</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">source-dirs</span><span class="kw">:</span><span class="at"> src</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="fu">executables</span><span class="kw">:</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">myApp-exe</span><span class="kw">:</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">main</span><span class="kw">:</span><span class="at">                Main.hs</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">source-dirs</span><span class="kw">:</span><span class="at">         app</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ghc-options</span><span class="kw">:</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> -threaded</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> -rtsopts</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> -with-rtsopts=-N</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">dependencies</span><span class="kw">:</span><span class="at"> </span><span class="kw">[]</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a><span class="co">      #- myApp</span></span></code></pre></div>
<p><code>Main.hs</code> 소스에서도 <code>import Lib</code>를 빼면</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="kw">module</span> <span class="dt">Main</span> <span class="kw">where</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="co">--import Lib</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="ot">main ::</span> <span class="dt">IO</span> ()</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>main <span class="ot">=</span> someFunc</span></code></pre></div>
<p>아래와 같은 에러가 나며, HLS가 시작되지 않습니다.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>  <span class="ex">ghcide</span> compiled by GHC 9.0 failed to load packages: <span class="op">&lt;</span>command line<span class="op">&gt;</span>: cannot satisfy <span class="at">-package</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="ex">myApp-0.1.0.0</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">(</span><span class="ex">use</span> <span class="at">-v</span> for more information<span class="kw">)</span><span class="bu">.</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="ex">Please</span> ensure that ghcide is compiled with the same GHC installation as the project.</span></code></pre></div>
<p>뜬금 없이 <code>HLS</code>에 포함되어 있는 <code>ghcide</code>가 프로젝트와 같은 <code>GHC</code> 버전으로 컴파일 되지 않았다는 에러입니다. 그런데, 그 위에 메시지를 보면 패키지 로드에 실패했다는 메시지도 보입니다. 이 상태에서 <code>stack build</code>를 하고 나면 <code>HLS</code>가 정상 동작합니다.</p>
<p><code>hie-bios</code><a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>는 <code>stack repl</code>을 쓰는데, <code>stack repl</code>은 <code>executables</code>에 있는 파일을 볼 때 <code>dependencies</code>에 있는 <em>로컬 라이브러리 컴포넌트는 빌드하지 않는다</em>고 합니다. <code>stack build</code>는 <code>library</code>와 <code>executables</code>를 모두 빌드하는데, <code>stack repl</code>은 다른 동작을 합니다. <code>stack</code>의 버그로 볼 수 있다고 합니다. (Ailrun님, 조언 감사합니다.) 이런 이유로 <code>Cabal</code>이 아닌 <code>stack</code>을 쓸 때는 <code>stack build</code>를 한 번 해줘야 <code>HLS</code>가 정상 동작합니다.</p>
<p><code>HLS</code>가 시작 못하는 진짜 이유는, <code>package.yaml</code>에 의존성이 지정되어 있는 패키지(여기 경우는 myApp)를 로드하려 하는데, 해당 패키지가 없기 때문입니다. 이 때, <code>stack build</code>를 하면 라이브러리가 쓰이든 안 쓰이든 모두 빌드됩니다.</p>
<p>만일 <code>Main.hs</code>를 아래와 같이 <code>import Lib</code>를 넣어 주면, <code>stack build</code>를 하지 않아도 <code>HLS</code>가 작동합니다.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="kw">module</span> <span class="dt">Main</span> <span class="kw">where</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="dt">Lib</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="ot">main ::</span> <span class="dt">IO</span> ()</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>main <span class="ot">=</span> someFunc</span></code></pre></div>
<p>장황하긴 한데, HLS가 동작하려면 필요한 조건과, <code>stack</code>이 일괄적인 동작을 하지 않는 부분은 알아두면 도움이 되는 곳이 있을 것 같습니다.</p>
<section class="footnotes" role="doc-endnotes">
<hr />
<ol>
<li id="fn1" role="doc-endnote"><p><strong>hie-bios</strong>
<code>HLS</code>가 하스켈 프로젝트를 어떻게 빌드할지 알아야 합니다. 어떤 플래그, 패키지등이 필요한지 정보가 필요합니다. <code>hie-bios</code>는 현재 사용중인 빌드 시스템으로부터 이런 정보들을 가져오는 툴입니다.
<a href="https://github.com/haskell/hie-bios/blob/master/README.md" class="uri">https://github.com/haskell/hie-bios/blob/master/README.md</a><a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

<div class="comment">
<script src="https://utteranc.es/client.js" repo="lionhairdino/lionhairdino.github.io" issue-term="url" theme="github-light" crossorigin="anonymous" async>
</script>
</div>
<div style="text-align:right">Github 계정이 없는 분은 메일로 보내주세요. lionhairdino at gmail.com </div>
        </div>
        <nav class="toc toc-right js-toc relative z-1 transition--300 absolute pa4 pt5 is-position-fixed"></nav>
        <div id="footer">
            © 2022 lionhairdino. All rights reserved. Generated by <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </div>
        <script>
            tocbot.init({
                tocSelector: '.js-toc',
                contentSelector: '.js-toc-content',
                headingSelector: 'h2, h3',
                hasInnerContainers: true,
            });
        </script>
    </body>
</html>
