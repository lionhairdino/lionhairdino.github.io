<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ko" lang="ko">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />

        <title>lionhairdino - 하스켈을 공부하는데 모나드가 벽이 되지 않도록</title>

        <meta name="description" content="어떤 구조를 모나드라 부르는지 수학없이 풀어 봤습니다." />
        <meta property="og:description" content="어떤 구조를 모나드라 부르는지 수학없이 풀어 봤습니다." />

        <link rel="stylesheet" type="text/css" href="../css/default.css" />
        <link rel="icon" href="https://lionhairdino.github.io/favicon.svg" />
        <link rel="icon" type="image/png" href="../images/favicon/Lionhairdino16px.png" sizes="16x16" />
        <link rel="icon" type="image/png" href="../images/favicon/Lionhairdino24px.png" sizes="24x24" />
        <link rel="icon" type="image/png" href="../images/favicon/Lionhairdino32px.png" sizes="32x32" />
        <link rel="icon" type="image/png" href="../images/favicon/Lionhairdino48px.png" sizes="48x48" />
        <link rel="icon" type="image/png" href="../images/favicon/Lionhairdino57px.png" sizes="57x57" />
        <link rel="icon" type="image/png" href="../images/favicon/Lionhairdino60px.png" sizes="60x60" />
        <link rel="icon" type="image/png" href="../images/favicon/Lionhairdino64px.png" sizes="64x64" />
        <link rel="icon" type="image/png" href="../images/favicon/Lionhairdino72px.png" sizes="72x72" />
        <link rel="icon" type="image/png" href="../images/favicon/Lionhairdino76px.png" sizes="76x76" />
        <link rel="icon" type="image/png" href="../images/favicon/Lionhairdino114px.png" sizes="114x114" />
        <link rel="apple-touch-icon-precomposed" href="../images/favicon/Lionhairdino120px.png" sizes="120x120" />
        <link rel="apple-touch-icon-precomposed" href="../images/favicon/Lionhairdino144px.png" sizes="144x144" />
        <link rel="shortcut icon" href="../favicon.ico" />
        <link rel="apple-touch-icon-precomposed" href="../images/favicon/Lionhairdino152px.png" sizes="152x152" />
        <link rel="apple-touch-icon-precomposed" href="../images/favicon/Lionhairdino180px.png" sizes="180x180" />
        <link rel="icon" type="image/png" href="../images/favicon/Lionhairdino192px.png" sizes="192x192" />
        <link rel="manifest" href="../site.webmanifest" />
        <link rel="mask-icon" href="https://lionhairdino.github.io/Lionhairdino_black.svg" color="#ff7500" />
        <meta name="msapplication-TileImage" content="/images/favicon/Lionhairdino144px.png" />
        <meta name="msapplication-TileColor" content="#ff7500" />
        <meta name="theme-color" content="#ffffff" />
        <meta property="og:type" content="website" />
        <meta property="og:title" content="하스켈을 공부하는데 모나드가 벽이 되지 않도록" />
        <meta property="og:site_name" content="Lionhairdino" />
        <meta property="og:url" content="https://lionhairdino.github.io/posts/2024-12-24-easyMonad.html" />

        <meta property="og:image" content="https://lionhairdino.github.io/images/state400px.png" />

      <meta name="keywords" content="모나드, 부리또, 부리토, Monad, 모노이드, Monoid">
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-E9WZ6VXGHP"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-E9WZ6VXGHP');
</script>
<script src="../script/copycode.js"></script>
<script async src="https://cse.google.com/cse.js?cx=9c53b4915cbb2605c"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.11.1/tocbot.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.11.1/tocbot.css" />
<meta name="fediverse:creator" content="@lionhairdino@mastodon.social">
    </head>
    <body>
        <div id="header">
            <div style="display:inline-block;margin-right:5px;padding-top: 5px;" id="logo">
                <a href="../"><img style="width:30px;border:none" src="../images/favicon/Lionhairdino48px.png"></a>
            </div>
            <div style="display:inline-block;vertical-align: top;padding-top:5px;" id="navigation">
                <a href="../">lionhairdino</a>
                <a href="../about.html">about</a>
                <!--<a href="/archive.html">archive</a>-->
            </div>
            <div style="display:inline-block;font-size:0.8em;vertical-align: top;">
                <div style="display:inline-block;vertical-align: top;padding-top: 5px"></div>
                <div style="display:inline-block;width:180px;"> 
                    <div class="gcse-searchbox-only"></div>
                </div>
                <div style="display:inline-block;vertical-align: top;padding-top: 11px; padding-left: 10px;"><a rel="me" href="https://mastodon.social/@lionhairdino"><img style="width:20px;border:none" src="../images/mastodon.svg"></a></div>
                <div style="display:inline-block;vertical-align: top;padding-top: 11px; padding-left: 2px;"><a href="https://lionhairdino.bsky.social"><img style="width:20px;border:none" src="../images/bluesky.svg"></a></div>
                <div style="display:inline-block;vertical-align: top;padding-top: 11px; padding-left: 2px;"><a href="https://discordapp.com/users/lionhairdino#7687"><img style="width:20px;border:none" src="../images/discord.svg"></a></div>
            </div>
            <div>
                여기 글들은 일종의 질문입니다. 용어 선택도 학계, 업계에서 쓰는 걸로 되어 있지 않고, 틀린 내용이 있을 수도 있습니다.
            </div>
        </div>
        <div class="js-toc-content">
            <h1>하스켈을 공부하는데 모나드가 벽이 되지 않도록</h1>
            <link rel="stylesheet" type="text/css" href="../css/syntax.css" />
<div class="info">
    Posted on December 24, 2024
    
</div>

<ul>
<li><p>여기 저기서 함수형 프로그래밍을 익혀보라는 추천들을 듣고, 함수형 언어중 가장 “함수형”스러운 하스켈을 선택합니다. 그리곤 술술 읽어가다 모나드에 도달하면! 포기합니다. 하스켈에는 모나드 말고도, 번뜩이는 개념들이 많은데, 모나드 벽에 막혀서 찍어 먹어 보지도 못하고 돌아서야 합니다.</p></li>
<li><p>모나드를 이해했다고 생각하는 선행자들은, 또 하나의 부리토를 만들어 낼까봐, 블로그에 모나드 관련 글을 올리지 못합니다.</p></li>
<li><p>매우 수학적이고, 원론적인 설명이거나, 가장 껍데기에 관련된 설명이거나 둘 중 하나를 만나고 넘어가면, 여전히 찜찜함은 사라지지 않습니다.</p></li>
<li><p>모나드가 어려운데, 처음부터 모나를 알 필요 없다고, 그냥 지나치자는 글을 보고, 위로를 받으며 진행해 보려 하지만, 얼마 못가 모나드가 또 길을 막습니다.</p></li>
</ul>
<p>처음 모나드를 보는 분이 아닌, 모나드에 한 번쯤, 다리 걸려 넘어져 봐서, 위 말들에 공감하는 분들을 위한 글입니다. 높은 확률로 또 하나의 <a href="https://byorgey.wordpress.com/2009/01/12/abstraction-intuition-and-the-monad-tutorial-fallacy/">부리토</a>가 나오겠지만, 계속 시도해 보겠습니다. 반복하다 보면, 언젠가 쓸만한 설명이 나오지 않을까요?</p>
<p><code>1</code>에 <code>(+ 2)</code>를 적용하면 <code>1 (+ 2) = 3</code><br />
위 결과 값에 다시 <code>(* 3)</code>을 적용하면 <code>3 (* 3) = 9</code><br />
위 결과 값에 다시 <code>(- 4)</code>을 적용하면 <code>9 (- 4) = 5</code>
…</p>
<p>위 작업을 보니, 함수들을 계속 적용하고 있습니다. 그럼 아래와 같이 뭉쳐서, <em>조합해서</em> 표현할 수 있습니다.<br />
<code>1</code>에 <code>(- 4) ⋅ (* 3) ⋅ (+ 2)</code>를 적용 후 결과로 <code>5</code>를 받습니다.</p>
<p>데이터에 순차적으로 연산을 적용하며 바뀌는 데이터 상태를 끌고 다니던 것을,<br />
<em>함수들만 먼저 모아 놓고</em>, 한 방에 적용하는 모양으로 바꿨습니다.</p>
<p>순서만 지킨다면 어떤 연산을 <em>먼저 묶어 적용</em>하든 같은 결과를 받을 수 있습니다.</p>
<p>현재 모델링하는 시스템은, 모든 데이터는 항상 세 개의 함수를 적용해서 결과를 얻어(반드시 특정 가공 절차를 거친 후), 다음에 이용한다고 가정하겠습니다. 모든 수는 세 개의 함수를 적용하는데, 어떤 값은 두 개, 혹은 한 개, 아니면 아예 함수를 적용하지 않고 써야하는 값이 있는 경우도 있는 상태입니다. 이 값은 “항상 세 개의 함수를 적용하는 절차를 거치는 값”으로 어떻게 표현할까요? <em>아무 일도 안함</em> 함수가 있으면 됩니다.</p>
<p>예를 들어 <code>2</code>를 변경 없이 그대로 쓰려면, <code>2</code>에 <code>아무 일도 안함</code> ⋅ <code>아무 일도 안함</code> ⋅ <code>아무 일도 안함</code>을 적용하면 됩니다.</p>
<p>위에 조건 세 가지를 얘기했는데, 정리하면[^1],
[^1]: 모노이드의 이항 함수, 항등원, 결합 법칙 입니다.</p>
<ol type="1">
<li><code>(+ 2)</code>, <code>(* 3)</code>, <code>(- 4)</code> 같은 함수들은 <code>⋅</code>을 이용해 계속 조합할 수 있고,</li>
<li><code>아무 일도 안함</code> 함수가 있고,</li>
<li><code>(+ 2) ⋅ (* 3)</code>하고 <code>(- 4)</code>를 적용하거나, <code>(+ 2)</code>하고, <code>(* 3) ⋅ (- 4)</code>를 적용하거나 같은 결과를 얻습니다.</li>
</ol>
<p>연산(함수)들이 위와 같은 조건을 만족하는 구조를, 이름부터 수학 냄새가 너무나는 <a href="../posts/2023-02-16-monoid.html">모노이드</a>라 부릅니다.<br />
함수들이 모노이드 구조를 만족하면, 먼저 연산(함수)들을 마음대로 조합해 놨다가, 값에 적용할 수 있습니다.(값이 아니라, <em>연산(함수)들이 모노이드 구조</em>를 이루고 있음을 눈여겨 보세요) 하스켈의 모든 실행 프로그램은 모노이드 구조를 따르고 있는데, 여기서는 거창한 수학 이름보다는 동작에만 집중해서 보시고, 일단 “모노이드가 되면 편하구나”를 믿고 넘어가겠습니다.</p>
<p>이 번에는, 연산을 하면, 다음에 또 연산을 바로 적용할 수 있는 값만 나오지 않고, 무언가 추가적인 정보를 가진 결과가 나오는 경우를 보겠습니다. 예를 들어, 연산을 적용하면서, 연산 횟수를 기억한다든지, 더 이상 연산할 수 있는 값이 나오지 않는다든지, 어떤 연산을 하고 있는지 화면에 출력한다든지…하는 연산 이외의 어떤 작업이 일어나는 경우입니다. 값만 나오던 연산과 구별해서 다음처럼 표기하겠습니다. (추가적인 정보를 Effect라 부르겠습니다. 왜 Effect라 부르는지는 나중에 <a href="../posts/2022-09-03-effect.html">여기</a>를 참고하세요.)</p>
<p><code>(+ 2) with Effect</code>, <code>(* 3) with Effect</code>, <code>(+ 4) with Effect</code><br />
(여기서 <code>with Effect</code>는, 모두 같은 동작을 합니다. 예를 들어, 횟수 기록을 한다면, 각 연산에 있는 <code>Effect</code>는 모두 같은 횟수 기록 동작을 합니다.)</p>
<p><code>1</code>에 <code>(+ 2)</code>를 적용 후 나온 <code>3</code>에 <code>(* 3)</code>을 적용하면 좋겠는데,<br />
<code>1</code>에 <code>(+ 2) with Effect</code>를 적용하면 <code>3 with Effect</code>가 나오고, 이를 숫자가 오길 기다리고 있는 <code>(* 3) with Effect</code>에 넣어 주지 못하는 상황입니다. <code>연산 with Effect</code>는 <code>⋅</code>을 써서 <code>(* 3) with Effect ⋅ (+ 2) with Effect</code> 처럼 묶어 놓을 수 없다는 얘기입니다. 다른 말로 하면, 모노이드로 만들지 못하니, 먼저 묶어 놨다가 적용하는 식으로 쓸 수 없습니다. 이렇게 되면 활용도가 훅 떨어집니다. 아래 해결책을 보기 전에, 먼저 해결책을 상상해 보시기 바랍니다.</p>
<p>어떻게 하면 <code>(* 3) with Effect ⋅ (+ 2) with Effect</code> 처럼 쓸 수 있을까요?</p>
<p>누군가가 <code>with Effect</code>를 떼어내서 <code>Effect</code>는 <code>Effect</code>대로 계산을 하고, <code>(+ 2)</code>와 <code>(* 3)</code>를 조립하고, 나중에 <code>with Effect</code>를 다시 붙여주는 작업을 하면 됩니다.
함수를 조립하던 <code>⋅</code> 함수를 <code>Effect</code>가 담당하면 딱인 작업입니다.</p>
<p><code>⋅</code>은 인자를 받아 첫 째 함수를 적용해서 결과값을 받은 후, 이 값을 두 번째 함수의 입력으로 주고, 결과를 받는 함수입니다.</p>
<p><code>f ⋅ g = \x -&gt; g (f x)</code></p>
<p>위 함수가 <code>Effect</code>를 지원하게 바꿔 보면,</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>f ∘ g <span class="ot">=</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>\<span class="fu">init</span> <span class="ot">-&gt;</span> </span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  result1 with <span class="dt">Effect1</span> <span class="ot">=</span> f <span class="fu">init</span> </span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  result2 with <span class="dt">Effect2</span> <span class="ot">=</span> g result1</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span> (result2 with (<span class="dt">Effect1</span>와 <span class="dt">Effect2</span> 합성))</span></code></pre></div>
<p>흠, 점 점 부리토가 될 확률이 높아지고 있습니다만, 계속해 보겠습니다.</p>
<p>위와 같은 <code>∘</code> 함수를 정의하면, 이제 다음처럼 쓸 수 있습니다.</p>
<p><code>(* 3) with Effect ∘ (+ 2) with Effect</code></p>
<p>위 합성 함수의 결과도 여전히 <code>연산 with Effect</code>입니다. 다시 말해, 연속으로 다음처럼 쓸 수도 있습니다.</p>
<p><code>(- 4) with Effect ∘ (* 3) with Effect ∘ (+ 2) with Effect</code></p>
<p><code>⋅</code> 대신 새로 <code>∘</code>을 정의했습니다.</p>
<p>이제, 현재 시스템에 있는 값은 모두 세 개의 절차를 거치는데, 변경 없이 그대로 쓰기 위해 필요했던 <code>아무 일도 안함</code>의 동작을 보겠습니다.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>연산 ⋅ 아무 일도 안함 <span class="ot">=</span> 그대로 연산</span></code></pre></div>
<p>위와 비슷하게</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>연산 with <span class="dt">Effect</span> ∘ (아무 일도 안함) <span class="ot">=</span> 그대로 연산 with <span class="dt">Effect</span></span></code></pre></div>
<p>가 되어야 합니다. <code>∘</code>의 동작을 보면, 안에 있는 <code>Effect1</code>과 <code>Effect2</code> 합성은 <code>Effect</code> 두 개가 필요합니다. 하지만, <code>아무 일도 안함</code>은 <code>Effect</code>가 없는 상태입니다.
<code>아무 일도 안함</code>을 <code>아무 일도 안함 with 기본 Effect</code>로 만들어 주는 <code>return</code>이란 함수를 정의할 수 있다면, 다음처럼 동작할 수 있습니다.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>연산 with <span class="dt">Effect</span> ∘ <span class="fu">return</span> (아무 일도 안함) <span class="ot">=</span> 그대로 연산 with <span class="dt">Effect</span></span></code></pre></div>
<p><code>Effect</code>가 없었을 때와 마찬가지로 결합에 상관없이 같은 결과가 나옴을 확인할 수 있습니다. (<span class="citation" data-cites="todo">@todo</span> 이 건 설명이 좀 부족하긴 합니다.)</p>
<p><code>연산 with Effect</code>는 <code>⋅</code>와 <code>아무 일도 안함</code>으론 모노이드가 되지 못했지만,<br />
<code>연산 with Effect</code>는 <code>∘</code>와 <code>return</code>이 있으면 모노이드가 됐습니다.</p>
<p>모노이드가 되지 못하던 <code>연산 with Effect</code> 모양이 <code>∘</code>와 <code>return</code>으로 모노이드가 되는 구조를 <strong><em>모나드</em></strong>라 부릅니다.</p>
<p>어슴푸레 “<a href="../posts/2022-03-25-beforeMonad.html">엔도 펑터의 모노이드</a>”란 말이, 무슨 말일지 보일 것만 같지 않나요? 물론, 여기 설명으로 모나드를 완전히 이해하는 건 불가능합니다. “완전한” 이해를 돕는 글을 목표로 하지 않았습니다. 수학 얘기를 최대한 빼내고, 비전공자 업자들이 모나드로 가는 길에, 볼만한 글이 되는 게 목표입니다.</p>
<p>이 번에도 새로운 부리토를 투척한 것 같은데, 포기하지 않고 2025년에 또 시도할 예정입니다.</p>

<div class="comment">
<script src="https://utteranc.es/client.js" repo="lionhairdino/lionhairdino.github.io" issue-term="url" theme="github-light" crossorigin="anonymous" async>
</script>
</div>
<div style="text-align:right">Github 계정이 없는 분은 메일로 보내주세요. lionhairdino at gmail.com </div>
        </div>
        <nav class="toc toc-right js-toc relative z-1 transition--300 absolute pa4 pt5 is-position-fixed"></nav>
        <div id="footer">
            © 2022 lionhairdino. All rights reserved. Generated by <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </div>
        <script>
            tocbot.init({
                tocSelector: '.js-toc',
                contentSelector: '.js-toc-content',
                headingSelector: 'h2, h3',
                hasInnerContainers: true,
            });
        </script>
    </body>
</html>
