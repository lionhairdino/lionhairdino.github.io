<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ko" lang="ko">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />

        <title>lionhairdino - Covariant, Contravariant, Positive, Negative</title>

        <meta name="description" content="단어 뜻만으로 보면 그리 어렵지 않은 뜻인데요. 무언가가 변할 때 함께 변하느냐, 역으로 변하느냐. 얼핏 이렇게만 들으면 금방 이해갈 것 같아 보이지만, 역시나 문서들은 친절하게 설명해 주지 않습니다. 왜 Consume하면 Contravarint고 Negative 위치라 부르는지." />
        <meta property="og:description" content="단어 뜻만으로 보면 그리 어렵지 않은 뜻인데요. 무언가가 변할 때 함께 변하느냐, 역으로 변하느냐. 얼핏 이렇게만 들으면 금방 이해갈 것 같아 보이지만, 역시나 문서들은 친절하게 설명해 주지 않습니다. 왜 Consume하면 Contravarint고 Negative 위치라 부르는지." />

        <link rel="stylesheet" type="text/css" href="../css/default.css" />
        <link rel="icon" href="https://lionhairdino.github.io/favicon.svg" />
        <link rel="icon" type="image/png" href="../images/favicon/Lionhairdino16px.png" sizes="16x16" />
        <link rel="icon" type="image/png" href="../images/favicon/Lionhairdino24px.png" sizes="24x24" />
        <link rel="icon" type="image/png" href="../images/favicon/Lionhairdino32px.png" sizes="32x32" />
        <link rel="icon" type="image/png" href="../images/favicon/Lionhairdino48px.png" sizes="48x48" />
        <link rel="icon" type="image/png" href="../images/favicon/Lionhairdino57px.png" sizes="57x57" />
        <link rel="icon" type="image/png" href="../images/favicon/Lionhairdino60px.png" sizes="60x60" />
        <link rel="icon" type="image/png" href="../images/favicon/Lionhairdino64px.png" sizes="64x64" />
        <link rel="icon" type="image/png" href="../images/favicon/Lionhairdino72px.png" sizes="72x72" />
        <link rel="icon" type="image/png" href="../images/favicon/Lionhairdino76px.png" sizes="76x76" />
        <link rel="icon" type="image/png" href="../images/favicon/Lionhairdino114px.png" sizes="114x114" />
        <link rel="apple-touch-icon-precomposed" href="../images/favicon/Lionhairdino120px.png" sizes="120x120" />
        <link rel="apple-touch-icon-precomposed" href="../images/favicon/Lionhairdino144px.png" sizes="144x144" />
        <link rel="shortcut icon" href="../favicon.ico" />
        <link rel="apple-touch-icon-precomposed" href="../images/favicon/Lionhairdino152px.png" sizes="152x152" />
        <link rel="apple-touch-icon-precomposed" href="../images/favicon/Lionhairdino180px.png" sizes="180x180" />
        <link rel="icon" type="image/png" href="../images/favicon/Lionhairdino192px.png" sizes="192x192" />
        <link rel="manifest" href="../site.webmanifest" />
        <link rel="mask-icon" href="https://lionhairdino.github.io/Lionhairdino_black.svg" color="#ff7500" />
        <meta name="msapplication-TileImage" content="/images/favicon/Lionhairdino144px.png" />
        <meta name="msapplication-TileColor" content="#ff7500" />
        <meta name="theme-color" content="#ffffff" />
        <meta property="og:type" content="website" />
        <meta property="og:title" content="Covariant, Contravariant, Positive, Negative" />
        <meta property="og:site_name" content="Lionhairdino" />
        <meta property="og:url" content="https://lionhairdino.github.io/posts/2022-11-10-coContraVarint.html" />

        <meta property="og:image" content="https://lionhairdino.github.io/images/state400px.png" />

      <meta name="keywords" content="Co, Contra, Covariant, Contravariant, Covariance, Contravariance, Positive, Negative, 공변, 반변, 반공변, haskell, 하스켈, 함수형, Functional">
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-E9WZ6VXGHP"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-E9WZ6VXGHP');
</script>
<script src="../script/copycode.js"></script>
<script async src="https://cse.google.com/cse.js?cx=9c53b4915cbb2605c"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.11.1/tocbot.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.11.1/tocbot.css" />
<meta name="fediverse:creator" content="@lionhairdino@mastodon.social">
    </head>
    <body>
        <div id="header">
            <div style="display:inline-block;margin-right:5px;padding-top: 5px;" id="logo">
                <a href="../"><img style="width:30px;border:none" src="../images/favicon/Lionhairdino48px.png"></a>
            </div>
            <div style="display:inline-block;vertical-align: top;padding-top:5px;" id="navigation">
                <a href="../">lionhairdino</a>
                <a href="../about.html">about</a>
                <!--<a href="/archive.html">archive</a>-->
            </div>
            <div style="display:inline-block;font-size:0.8em;vertical-align: top;">
                <div style="display:inline-block;vertical-align: top;padding-top: 5px">사이트내 검색</div>
                <div style="display:inline-block;width:180px;"> 
                    <div class="gcse-searchbox-only"></div>
                </div>
                <div style="display:inline-block;vertical-align: top;padding-top: 11px; padding-left: 10px;"><a rel="me" href="https://mastodon.social/@lionhairdino"><img style="width:20px;border:none" src="../images/mastodon.svg"></a></div>
                <div style="display:inline-block;vertical-align: top;padding-top: 11px; padding-left: 2px;"><a href="https://lionhairdino.bsky.social"><img style="width:20px;border:none" src="../images/bluesky.svg"></a></div>
                <div style="display:inline-block;vertical-align: top;padding-top: 11px; padding-left: 2px;"><a href="https://discordapp.com/users/lionhairdino#7687"><img style="width:20px;border:none" src="../images/discord.svg"></a></div>
            </div>
            <div>
                여기 글들은 일종의 질문입니다. 용어 선택도 학계, 업계에서 쓰는 걸로 되어 있지 않고, 틀린 내용이 있을 수도 있습니다.
            </div>
        </div>
        <div class="js-toc-content">
            <h1>Covariant, Contravariant, Positive, Negative</h1>
            <link rel="stylesheet" type="text/css" href="../css/syntax.css" />
<div class="info">
    Posted on November 10, 2022
    
</div>

<h2 id="co-contra">Co, Contra</h2>
<p>어원<br />
co- “together, with” - <a href="https://www.etymonline.com/search?q=co-">Etymonline</a><br />
contra- “against, in oppsition” - <a href="https://www.etymonline.com/search?q=contra-">Etymonline</a></p>
<p>순방향, 역방향<br />
같은 방향으로, 반대 방향으로<br />
등을 의미할 때 주로 쓰입니다.
무언가 기준이 있고, 그 것의 움직임, 변화에 따라 다른 것이 어떻게 되냐에 따라 붙는 용어입니다.</p>
<h2 id="variant">Variant</h2>
<p>어원은 “tending to change”인데, 변하려는 성향정도 번역할 수 있을까요? 자료들을 보면 “변성”이라고 번역하기도 합니다. 위 접두어와 합치면, 같은 방향으로 변하면 공변covariant, 반대 방향으로 변하면 반변contravariant입니다. 반변은 반공변으로 번역하기도 합니다.</p>
<h2 id="기저-벡터">기저 벡터</h2>
<p>웹에서 Covariant, Contravariant를 검색하면, 수학쪽 용어도 같이 검색됩니다. 예를 들어 기저 벡터를 phi만큼 회전하면, 좌표 변환은 -phi만큼 돌린 것과 같습니다. 이럴 때 반대로Contra 변성variant, Contravariant 합니다.</p>
<h2 id="oop에서">OOP에서</h2>
<p>※ <code>P</code> : Parent 의미, <code>C</code> : Child 의미</p>
<p>아래와 같은 상황을 가정하면<br />
</p>
<p><code>P</code>는 <code>a</code>, <code>b</code>, <code>c</code> 메소드를 가지고 있고,<br />
<code>C</code>는 <code>P</code>가 할 수 있는 <code>a</code>, <code>b</code>, <code>c</code>는 모두 그대로 가지고 있고, <code>d</code>, <code>f</code> 메소드도 있다.</p>
<p>이럴 때 <code>P</code>가 필요한 자리에, <code>C</code>를 넣을 수 있습니다. <code>P</code>타입을 받는다는 건, <code>a</code>, <code>b</code>, <code>c</code> 메소드를 쓰겠다는 건데, <code>C</code>타입도 이들 메소드를 모두 가지고 있으니 문제가 생기지 않습니다.</p>
<p><code>P(super) &lt;- C(sub)</code> 관계가 있을 때, <code>P</code>와 <code>C</code>에 의존하는 어떤 Generic 클래스, 타입 등이
<code>SomeVariant P &lt;- SomeVariant C</code>
와 같이 변성(변환) 전의 것과 같은 방향의 관계가 있을 때는 Covariant, 반대일 때는 Contravariant라 합니다.</p>
<h2 id="하스켈에서는-무엇이-변할까">하스켈에서는 무엇이 변할까?</h2>
<p>위에 예를 든 것처럼, 다른 곳에서도 이 용어는 많이 쓰입니다. 여기서는 하스켈에서 타입 얘기를 할 때 나오는 뜻만 보겠습니다. 적어도 두 가지가 변화하는 게 있어야, 이 용어를 쓸텐데, 무엇이 변화할 때 무엇이 co, contra란 말 없이 그냥 covariant와 contravariant로 설명하는 경우가 있어, 금방 이해가 가지 않을 때가 있습니다.</p>
<p>하스켈에선 Functor로 타입이 변환 되었을 때, 기존 관계(함수)가 어떻게 되느냐에 관한 용어입니다.</p>
<p><code>P</code>, <code>C</code> 타입이 있고, <code>f :: P -&gt; C</code> 란 함수가 있을 때 <code>SomeFunctor</code>로 변환한다면,
<code>SomeFunctor P</code>, <code>SomeFunctor C</code> 로 변환하고, 함수가<br />
<code>f 변환 :: SomeFunctor P -&gt; SomeFunctor C</code> 이면 Covariant 이고,
<code>f 변환 :: SomeFunctor P &lt;- SomeFunctor C</code> 이면 Contravariant 라 합니다.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fmap</span><span class="ot"> ::</span> (a <span class="ot">-&gt;</span> b) <span class="ot">-&gt;</span> <span class="dt">Maybe</span> a <span class="ot">-&gt;</span> <span class="dt">Maybe</span> b</span></code></pre></div>
<p>이 <code>fmap</code>은 <code>a -&gt; b</code>를 <code>Maybe</code>로 변환하면 <code>Maybe a -&gt; Maybe b</code>로 만들기 때문에 Covariant functor라고 부릅니다. 예를 들면, <code>Int -&gt; String</code> 함수를 covariant functor로 변환해서 <code>Maybe Int</code> 에 적용할 수 있습니다. 여기까진 자주 보던 것으로 그리 낯설지 않습니다. 그런데, <code>Int</code>가 출력에 있는 <code>Double -&gt; Int</code> 같은 함수는 <code>Maybe Int</code>에 적용할 수 없습니다.</p>
<p>만일, <code>a -&gt; b</code>가 <code>Some b -&gt; Some a</code>로 변환되면 <code>Some</code>은 <code>a</code>에 Contravariant라 말하는데, 다음에서 예시를 보겠습니다.</p>
<h2 id="contravariant">Contravariant</h2>
<p><a href="https://www.fpcomplete.com/blog/2016/11/covariance-contravariance/">FPcomplete Covariance and Contravariance 에서 발췌</a></p>
<div class="sourceCode" id="cb2"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">newtype</span> <span class="dt">MakeString</span> a <span class="ot">=</span> <span class="dt">MakeString</span> {<span class="ot"> makeString ::</span> a <span class="ot">-&gt;</span> <span class="dt">String</span> }</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">showInt</span><span class="ot"> ::</span> <span class="dt">MakeString</span> <span class="dt">Int</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">showInt</span> <span class="ot">=</span> <span class="dt">MakeString</span> <span class="fu">show</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co">-- (a -&gt; b)가 아니라 (b -&gt; a)입니다.</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="ot">mapMakeString ::</span> (b <span class="ot">-&gt;</span> a) <span class="ot">-&gt;</span> <span class="dt">MakeString</span> a <span class="ot">-&gt;</span> <span class="dt">MakeString</span> b</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>mapMakeString f (<span class="dt">MakeString</span> g) <span class="ot">=</span> <span class="dt">MakeString</span> (g <span class="op">.</span> f)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="ot">plus3ShowInt ::</span> <span class="dt">MakeString</span> <span class="dt">Int</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>plus3ShowInt <span class="ot">=</span> mapMakeString (<span class="op">+</span><span class="dv">3</span>) <span class="fu">showInt</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="ot">main ::</span> <span class="dt">IO</span> ()</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>main <span class="ot">=</span> <span class="fu">putStrLn</span> <span class="op">$</span> makeString plus3ShowInt <span class="dv">5</span></span></code></pre></div>
<p><code>makeString</code> 함수는 어떤 타입이든 받아서 <code>String</code> 타입을 돌려주는 함수입니다. 예를 들면 타입에 따라 타입 이름을 돌려 준다든지 하는 함수일 수 있습니다. 일단 시작부터 의도가 보입니다. <code>a</code>가 출력에 있지 않고, 입력에 있습니다. 이게 <code>fmap</code>을 구현할 때 어떤 영향을 미치는지 보겠습니다.<br />
<code>showInt</code>는 정수를 받아 문자열로 바꾸는 함수입니다. 그런데, 이 함수로 출력하기 전에, 정수값을 변화 시키는 함수(+3)를 먼저 적용 후 문자열로 출력하게 하고 싶습니다. 이럴 경우, 자주 썼던 covariant functor로 시도해 보겠습니다. 위 <code>FPcomplete</code>의 예시는 <code>(+1) :: Int -&gt; Int</code>으로 입력과 출력이 <code>Int</code>로 같아 미스 매치되는게 잘 안보이니, 원래 타입 그대로 두고 매칭 여부를 보겠습니다.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="ot">mapMakeString ::</span> (a <span class="ot">-&gt;</span> b) <span class="ot">-&gt;</span> <span class="dt">MakeString</span> a <span class="ot">-&gt;</span> <span class="dt">MakeString</span> b</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>mapMakeString f (<span class="dt">MakeString</span> g) <span class="ot">=</span> <span class="dt">MakeString</span> (g <span class="op">.</span> f)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>mapMakeString (<span class="op">+</span><span class="dv">3</span><span class="ot"> ::</span> a <span class="ot">-&gt;</span> b) (<span class="fu">showInt</span><span class="ot"> ::</span> a <span class="ot">-&gt;</span> <span class="dt">String</span>) </span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="ot">=</span> <span class="dt">MakeString</span> ( <span class="fu">showInt</span> <span class="op">.</span> (<span class="op">+</span><span class="dv">3</span>)<span class="ot"> ::</span> b <span class="ot">-&gt;</span> <span class="dt">String</span>)</span></code></pre></div>
<p>이렇게 하면 될 것 같지만, 타입을 적어보면 출력이 맞지 않습니다. <code>(+3) :: a -&gt; b</code> 이니, 그 다음 함수 <code>showInt</code>는 <code>b -&gt; String</code>을 받아야 합니다. 하지만 <code>showInt</code>는 <code>a -&gt; String</code>입니다. 말로 풀어 보면, <code>(+3)</code>을 나중에 적용하는 게 아니라, 먼저 적용한 후 <code>showInt</code>를 적용하고 있습니다. <code>MakeString</code> 타입의 폴리모픽 부분은 출력이 아니라, 입력입니다. <code>mapMakeString</code>을 적용해서 합성이 이루어질 때, 이 폴리모픽한 부분은 먼저 들어 온 함수의 입력과 만나지 않고, 출력과 만나야만 원하는 동작을 합니다. 소스를 잘 읽어보면 <code>(b -&gt; a)</code>로 뒤집힌 걸 요구하기 때문에 그냥 covariant functor로 구현할 수 없습니다.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="ot">mapMakeString ::</span> (b <span class="ot">-&gt;</span> a) <span class="ot">-&gt;</span> <span class="dt">MakeString</span> a <span class="ot">-&gt;</span> <span class="dt">MakeString</span> b</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>mapMakeString f (<span class="dt">MakeString</span> g) <span class="ot">=</span> <span class="dt">MakeString</span> (g <span class="op">.</span> f)</span></code></pre></div>
<p>이렇게 Contravariant하게 변하는 걸 fmap하기 위해 아래와 같이 뒤집힌 타입을 메소드로 가진 클래스가 있습니다.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> <span class="dt">Contravariant</span> f <span class="kw">where</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="ot">  contramap ::</span> (a <span class="ot">-&gt;</span> b) <span class="ot">-&gt;</span> f b <span class="ot">-&gt;</span> f a</span></code></pre></div>
<p><em>결과 타입은 고정되어 있는데, 입력 타입이 달라질 필요가 있을 때 쓸 수 있습니다.</em> (<code>fmap</code>은 covariant한 경우에 쓴다고 말하는데, 잘 생각해 보면, <code>fmap</code>은 입력 타입이 고정이고, 결과 타입이 달라질 필요가 있을 때 써왔습니다.)</p>
<h2 id="입력-위치에-있으면-contravariant">입력 위치에 있으면 Contravariant</h2>
<p>출력에 있으면 Covariant<br />
입력에 있으면 Contravariant<br />
</p>
<p>위와 같은 상황에서도 같은 용어를 쓰는데, 무엇이 기준이고 무엇이 따라 변하는 건지 모호합니다. 이전 섹션의 Contravariant를 보면, <code>a</code>에서 <code>Some a</code>로 변환할 때, <code>Some</code> 정의안에 <code>a</code>의 위치가 <code>SomeType -&gt; a</code>이면, 특별히 “a와”란 말을 쓰지 않고도, 그냥 Covariant란 말을 쓰고, <code>a -&gt; SomeType</code>이면 <code>a</code>와 Contravariant라고 말합니다. functor의 성질이 <code>a</code>의 위치에 따라 Co, Contra로 바뀝니다.</p>
<h2 id="consume하면-contravariant">Consume하면 Contravariant</h2>
<p>Produce하면 Covariant<br />
Consume하면 Contravariant</p>
<p><code>SomeType -&gt; a</code>이면 결과로 <code>a</code>를 만들어내니 Produce한다고 말하고, <code>a -&gt; SomeType</code>은 <code>a</code>를 인자로 받아 써먹으니 Consume이라 말합니다.</p>
<h2 id="consume하면-negative-produce하면-positive">Consume하면 Negative, Produce하면 Positive</h2>
<blockquote>
<p>생각 스트레칭<br />
<code>(a -&gt; b) -&gt; b</code> 타입만으로 알 수 있는 게 있습니다.<br />
이 함수는 다른 걸 받는 건 없고, <code>(a -&gt; b)</code>함수만 받으면 <code>b</code>라는 값을 만들어 냅니다. <code>(a -&gt; b)</code>함수를 실행하면 <code>b</code>가 나올텐데, 실행하려면 <code>a</code>가 필요합니다. 함수만 받았는데, <code>b</code>가 나온다는 말은, 안에 이미 <code>a</code>가 있을거라 예상할 수 있습니다. (물론, 받은 함수를 무시할 수도 있겠지만, <code>b</code>를 generate할 방법은 어떤식으로든 존재해야 합니다.)</p>
<p>※ 엄밀히 얘기하면, <code>forall a =&gt; (a -&gt; b) -&gt; b</code> 일 때, 이 함수는 <code>a</code>가 뭔지 모르니, <code>a</code>를 가지고 있을 방법이 없습니다.(딱 한가지 undefined(bottom)을 가지고 있다고 말할 순 있겠습니다만) 예시는 조금 더 다듬어야 하지만, 이해하는데 도움은 되는 예시니 일단 그대로 두겠습니다. <span class="citation" data-cites="jason님이">@jason님이</span> 놓친 걸 지적해 주셨습니다. 감사합니다.</p>
<p>아래는 사장, 팀장, 요리사, 레시피가 모여 요리를 만드는 코드입니다.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="dt">Meat</span> <span class="ot">=</span> <span class="dt">Beef</span> <span class="op">|</span> <span class="dt">Pork</span> <span class="kw">deriving</span> <span class="dt">Show</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="dt">Cooking</span> a <span class="ot">=</span> <span class="dt">Steak</span> a <span class="op">|</span> <span class="dt">Stew</span> a <span class="kw">deriving</span> <span class="dt">Show</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="kw">newtype</span> <span class="dt">Cookbook</span> <span class="ot">=</span> <span class="dt">Cookbook</span> {<span class="ot"> runCook ::</span> <span class="dt">Meat</span> <span class="ot">-&gt;</span> <span class="dt">Cooking</span> <span class="dt">Meat</span> }</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="ot">steakRecipe ::</span> <span class="dt">Meat</span> <span class="ot">-&gt;</span> <span class="dt">Cooking</span> <span class="dt">Meat</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>steakRecipe <span class="ot">=</span> <span class="dt">Steak</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="ot">chef ::</span> <span class="dt">Cookbook</span> <span class="ot">-&gt;</span> <span class="dt">Cooking</span> <span class="dt">Meat</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>chef cb <span class="ot">=</span> runCook cb <span class="dt">Beef</span> </span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="co">-- leader는 chef가 들어오면 준비된 steak recipe를 넣어 줍니다.</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="ot">leader ::</span> (<span class="dt">Cookbook</span> <span class="ot">-&gt;</span> <span class="dt">Cooking</span> <span class="dt">Meat</span>) <span class="ot">-&gt;</span> <span class="dt">Cooking</span> <span class="dt">Meat</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>leader ch <span class="ot">=</span> ch (<span class="dt">Cookbook</span> steakRecipe) </span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="co">-- boss는 외부에서 leader가 들어오면 Beef를 다루는 chef를 붙여 줍니다.</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="ot">boss ::</span> ((<span class="dt">Cookbook</span> <span class="ot">-&gt;</span> <span class="dt">Cooking</span> <span class="dt">Meat</span>) <span class="ot">-&gt;</span> <span class="dt">Cooking</span> <span class="dt">Meat</span>) <span class="ot">-&gt;</span> <span class="dt">Cooking</span> <span class="dt">Meat</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>boss ld <span class="ot">=</span> ld chef </span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>main <span class="ot">=</span> <span class="fu">print</span> <span class="op">$</span> boss leader</span></code></pre></div>
<p>위 예시는 <code>boss, leader, chef, recipe</code> 가 모두 있어야 요리가 만들어 집니다.<br />
<code>boss</code>는 <code>leader</code>없이 <code>chef</code>만 데리고 있습니다.<br />
<code>leader</code>는 <code>recipe</code>만 가지고 있습니다.<br />
<code>boss</code>에 <code>leader</code>를 넣어 주면, <code>boss</code>가 가진 <code>chef</code>를 <code>leader</code>에게 넣어 주고,<br />
<code>leader</code>는 가지고 있는 <code>recipe</code>를 <code>chef</code>에 넣어 줘서 요리를 만들게 됩니다.</p>
</blockquote>
<p>위에서 말한 Consume 모양 중 <code>V -&gt; Int</code> 함수를 받는 고차 함수를 살펴 보겠습니다. reduce하려면 필요한 정보가 어디에 있는지 살펴 보겠습니다.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="ot">func1 ::                 f ::</span> <span class="dt">V</span> <span class="ot">-&gt;</span> <span class="dt">Int</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="ot">func2 ::</span>               (<span class="ot"> f ::</span> <span class="dt">V</span> <span class="ot">-&gt;</span> <span class="dt">Int</span> ) <span class="ot">-&gt;</span> <span class="dt">Int</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="ot">func3 ::</span>        (<span class="ot"> g ::</span> (<span class="ot"> f ::</span> <span class="dt">V</span> <span class="ot">-&gt;</span> <span class="dt">Int</span> ) <span class="ot">-&gt;</span> <span class="dt">Int</span> ) <span class="ot">-&gt;</span> <span class="dt">Int</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="ot">func4 ::</span> (<span class="ot"> h ::</span> (<span class="ot"> g ::</span> (<span class="ot"> f ::</span> <span class="dt">V</span> <span class="ot">-&gt;</span> <span class="dt">Int</span> ) <span class="ot">-&gt;</span> <span class="dt">Int</span> ) <span class="ot">-&gt;</span> <span class="dt">Int</span> ) <span class="ot">-&gt;</span> <span class="dt">Int</span></span></code></pre></div>
<p>실행되는 코드는 아니고, 고차 함수들이 함수를 인자로 받는 부분에 <code>f</code>,<code>g</code>,<code>h</code> 이름을 붙여 놨습니다.</p>
<ul>
<li><code>func1</code>은 외부에서 <code>V</code>값을 받을테고, - 외부에서 들어온 값을 Consume합니다.<br />
</li>
<li><code>func2</code>는 내부에 <code>f</code>에 넣을 정해진 <code>V</code>값이 이미 있고, - 내부에서 Produce합니다.<br />
</li>
<li><code>func3</code>는 <code>f</code>모양의 “함수” 인자를 가지고 있고, <code>V</code>값은 <code>g</code>의 자리로 들어오는 함수가 가지고 있습니다. 즉 외부에서 값이 들어 옵니다. - 외부에서 들어온 값을 Consume합니다.<br />
</li>
<li><code>func4</code>는 <code>g</code>모양의 “함수” 인자를 가지고 있습니다. 이 함수 안에는 이미 정해진 <code>V</code>값이 들어 있습니다. - 내부에서 Produce합니다.</li>
</ul>
<p>잘 보면, <code>V</code>가 contravariant 위치에 있는 함수를 받는 고차 함수를, 차수를 올릴 때마다 Consume, Produce가 반복되고 있습니다.</p>
<ul>
<li><code>V</code>가 Contravariant 위치에 있는 <code>func1</code>은 Consume이지만,<br />
</li>
<li><code>f :: V -&gt; Int</code> 자체가 Contravariant위치에 있으면 Produce하게 됩니다.<br />
</li>
<li>한 번 더 <code>g :: ( V -&gt; Int ) -&gt; Int</code> 자체를 Contravariant에 두면, 다시 Consume으로 바뀝니다.<br />
</li>
<li>한 번 더 <code>h :: (( V -&gt; Int ) -&gt; Int ) -&gt; Int)</code> 자체를 Contravariant 두면, 또 다시 Produce로 바뀝니다.</li>
</ul>
<p>마치 마이너스(-), 즉 Negative 기호 연산(음수 x 음수 = 양수)을 반복하는 것 같은 모양이 나옵니다. Contravariant인 것을 Contravariant에 두면 Covariant로 바뀌고 있습니다. 이런 성질 때문에 Negative, Positive로 표현하기도 합니다.</p>
<blockquote>
<p><span class="citation" data-cites="재원님이">@재원님이</span> <code>(a -&gt; b) -&gt; b</code> 형태의 함수는 안에 <code>a</code>를 가지고 있다는 설명 방식에 헛점이 있다고 지적해 주셨습니다. 왜냐하면 꼭 <code>a</code>를 가지고 있지 않고, 함수 자체를 써먹지 않고 버리고, 어떤 방법으로 <code>a</code>를 만들어 낼 수도 있으니 “반드시” <code>a</code>를 가지고 있을 거라 설명하면 안된다는 말씀입니다. 물론, 맞는 말씀인데, 여기선 직관을 위해 “대부분” 그럴거란 가정하에 그대로 두었습니다. <code>a</code>를 미리 가지고 있다 = <code>a</code>를 생성generate 한다와 같은 의미로 봐주시면 되겠습니다.</p>
</blockquote>
<blockquote>
<p><span class="citation" data-cites="다믜님의">@다믜님의</span> Positive/Negative 설명입니다. <span class="citation" data-cites="다믜님">@다믜님</span> 허락하에 원문을 올립니다.</p>
<p><code>a -&gt; b</code> 를 구현할 때에는 <code>a</code>가 주어지니 이걸 사용하기만 하면 되죠. negative입니다.<br />
<code>(a -&gt; b) -&gt; c</code> 의 경우 <code>a -&gt; b</code>가 주어지는데, 이걸 사용하는 유일한 방법은 <code>a -&gt; b</code>에 인자로 <code>a</code>를 주는것입니다. 결국 <code>a</code>를 만들어줘야 하죠. positive입니다.<br />
<code>((a -&gt; b) -&gt; c) -&gt; d</code> 에서는 <code>(a -&gt; b) -&gt; c</code> 가 주어지고 이걸 사용하려면 <code>a -&gt; b</code> 를 건네줘야 하죠. 그리고 <code>a -&gt; b</code> 를 만들 때에는 주어진 <code>a</code>를 사용하면 되니 결국 <code>a</code>를 받는 꼴이 됩니다. negative가 되지요</p>
<p>negative/positive를 이해하는 다른 좋은 방법으로 monotonic function이 있는데요<br />
increasing function은 postivive, decreasing function은 negative에 대응이 됩니다.
increasing function은 <code>a ≤ b → f(a) ≤ f(b)</code> 를 만족하는 함수 <code>f</code>, decreasing function은 <code>b ≤ a → f(a) ≤ f(b)</code> 를 만족하는 함수 <code>f</code>를 말하는데, 이것만 보더라도 이미 co/contra-variant functor와의 유사성이 보이죠<br />
</p>
<p>그리고 increasing/decreasing function을 합성할 때 decreasing function이 짝수 번 나오면 increasing, 홀수 번 나오면 decreasing이 된다는걸 쉽게 할 수 있습니다
가령 <code>f</code>, <code>g</code> 가 decreasing function이라고 할 때 <code>f∘g</code> 가 어떻게 되는지 보면<br />
1. <code>a ≤ b</code> 이면 <code>g(b) ≤ g(a)</code> (<code>g</code>가 decreasing 이므로)<br />
2. <code>g(b) ≤ g(a)</code> 이면 <code>f(g(a)) ≤ f(g(b))</code> (<code>f</code>가 decreasing 이므로)<br />
3. 1,2 를 합하면 <code>a ≤ b</code> 일 때 <code>f(g(a)) ≤ f(g(b))</code>. 즉 <code>f∘g</code> 는 increasing. 이렇게 됩니다.<br />
이걸 굳이 monotonic function으로 설명한 이유는 이제 그래프로 볼 수가 있어서 그렇습니다.</p>
<figure>
<img src="../images/440px-Monotonicity_example1.svg.png" alt="increasing" />
<figcaption aria-hidden="true">increasing</figcaption>
</figure>
<figure>
<img src="../images/440px-Monotonicity_example2.svg.png" alt="decreasing" />
<figcaption aria-hidden="true">decreasing</figcaption>
</figure>
<p>각각 increasing/decreasing function의 그래프구요
decreasing function 두개를 합성하면 increasing이 된다는건 아무 점이나 두개찍고 대소관계를 비교해보면 쉽게 느낄 수 있습니다
negative/positive란 용어는 논리학에서 왔구요, 함수를 대상으로 하는 경우에는 monotonic, increasing/decreasing이라는 표현을 주로 사용하죠. 카테고리에서 이제 covariant/contravariant라는 표현을 쓰구요</p>
</blockquote>
<p>※ 참고<br />
<a href="https://enshahar.github.io/java/2021/09/03/java-type-and-variance/">정적 타입 지정과 변성 - 오현석</a><br />
<a href="https://www.fpcomplete.com/blog/2016/11/covariance-contravariance/">FPcomplete Covariance and Contravariance</a></p>

<div class="comment">
<script src="https://utteranc.es/client.js" repo="lionhairdino/lionhairdino.github.io" issue-term="url" theme="github-light" crossorigin="anonymous" async>
</script>
</div>
<div style="text-align:right">Github 계정이 없는 분은 메일로 보내주세요. lionhairdino at gmail.com </div>
        </div>
        <nav class="toc toc-right js-toc relative z-1 transition--300 absolute pa4 pt5 is-position-fixed"></nav>
        <div id="footer">
            © 2022 lionhairdino. All rights reserved. Generated by <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </div>
        <script>
            tocbot.init({
                tocSelector: '.js-toc',
                contentSelector: '.js-toc-content',
                headingSelector: 'h2, h3',
                hasInnerContainers: true,
            });
        </script>
    </body>
</html>
